---
toc: true
toc_label: "MySQL ä¸»ä»Žå¤åˆ¶"
toc_icon: "copy"
title: "MySQL ä¸»ä»Žå¤åˆ¶"
tags: mysql ä¸»ä»Ž åŒæ­¥ å¤åˆ¶
categories: "database"
classes: wide
excerpt: ""
header:
  overlay_image: /assets/images/header/mysql.jpg
  overlay_filter: rgba(0, 0, 0, 0.8)
---







## MySQL çš„å¤åˆ¶åŠŸèƒ½

MySQL çš„ä¸»ä»Žå¤åˆ¶æ¥æºäºŽå…¶ç‰¹æœ‰çš„è¯æ±‡ï¼šå¤åˆ¶ï¼Œå³ **Replication**ã€‚å› æ­¤åœ¨ MySQL çš„è¯­å¢ƒä¸­ï¼Œæåˆ°çš„å¤åˆ¶ä¸»è¦æ˜¯æŒ‡è¿™ä¸ªå¤åˆ¶ï¼Œè€Œä¸æ˜¯é€šå¸¸æ„ä¹‰çš„ copyã€‚
{: .notice--success}

é€šè¿‡å¤åˆ¶ï¼Œå¯ä»¥è®©æ•°æ®ä»Žä¸€ä¸ª MySQL æ•°æ®åº“æœåŠ¡å™¨è¢«å¤åˆ¶åˆ°å¦ä¸€ä¸ªæˆ–å¤šä¸ª MySQL æ•°æ®åº“æœåŠ¡å™¨ä¸­ï¼Œå‰è€…ç§°ä¸º **ä¸»æœåŠ¡å™¨**ï¼Œå³ Masterï¼ŒåŽè€…ç§°ä¸º **ä»ŽæœåŠ¡å™¨**ï¼Œå³ Slavesã€‚è¿™å°±æ˜¯æ‰€è°“çš„ä¸»ä»Žã€‚

å¤åˆ¶é»˜è®¤æ˜¯ **å•å‘**ã€ **å¼‚æ­¥** è¿›è¡Œçš„ï¼Œå› æ­¤ï¼Œä»ŽæœåŠ¡å™¨æ— éœ€ä¸ºäº†æ”¶åˆ°æ›´æ–°è€Œä¸€ç›´ä¿æŒè¿žæŽ¥ã€‚è¿™å°±æ„å‘³ç€æ›´æ–°æ˜¯å¯ä»¥åœ¨è¿œè·ç¦»è¿žæŽ¥ä¸Šè¿›è¡Œçš„ï¼Œç”šè‡³å¯ä»¥åœ¨ä¸´æ—¶çš„æˆ–é—´æ–­æ€§çš„è¿žæŽ¥ä¸Šè¿›è¡Œï¼Œå¦‚æ‹¨å·è¿žæŽ¥ã€‚æ ¹æ®é…ç½®ï¼Œå¯ä»¥å¤åˆ¶å…¨éƒ¨æ•°æ®åº“ã€éƒ¨åˆ†æ•°æ®åº“ã€æˆ–åº“ä¸­æŒ‡å®šçš„è¡¨ã€‚








### å¤åˆ¶çš„ä¼˜ç‚¹

MySQL å†…ç½®çš„å¤åˆ¶åŠŸèƒ½ï¼Œé…åˆä½¿ç”¨è¿™ç§å¯æ‰©å±•çš„æž¶æž„ï¼Œæ˜¯å»ºè®¾å¤§åž‹ã€é«˜æ€§èƒ½åº”ç”¨çš„åŸºç¡€ã€‚è¿™ç§ä¸»ä»Žå¤åˆ¶ä¸ä»…ä»…æœ‰åˆ©äºŽé«˜æ€§èƒ½çš„åº”ç”¨ç¨‹åºï¼Œå®ƒè¿˜æ˜¯è®¸å¤šç­–ç•¥çš„åŸºçŸ³ï¼ŒåŒ…æ‹¬ï¼šé«˜å¯ç”¨ã€å¯æ‰©å±•æ€§ã€ç¾éš¾æ¢å¤ã€å¤‡ä»½ã€æ•°æ®åˆ†æžã€æ•°æ®ä»“åº“ç­‰ä»»åŠ¡ã€‚

* å¯æ‰©å±•è§£å†³æ–¹æ¡ˆï¼šæŠŠè´Ÿè½½åˆ†æ‘Šåˆ°å¤šä¸ªä»ŽæœåŠ¡å™¨ä¸Šï¼Œä»Žè€Œæå‡æ€§èƒ½ã€‚åœ¨è¯¥çŽ¯å¢ƒä¸‹ï¼Œæ‰€æœ‰çš„ **å†™** å’Œ **æ›´æ–°** æ“ä½œå¿…é¡»å‘ç”ŸäºŽ **ä¸»** æœåŠ¡å™¨ä¸Šï¼Œå³ä¸»æœåŠ¡å™¨ä¸“ç”¨äºŽæ›´æ–°ã€‚è€Œ **è¯»** æ“ä½œï¼Œå¯ä»¥å‘ç”Ÿåœ¨ä¸€ä¸ªæˆ–å¤šä¸ª **ä»Ž** æœåŠ¡å™¨ä¸Šã€‚è¿™ç§æ¨¡å¼ä¸€æ–¹é¢ä¼šæå‡å†™çš„æ€§èƒ½ï¼Œå¦ä¸€æ–¹é¢ï¼Œä¸æ–­å¢žé•¿çš„ä»ŽæœåŠ¡å™¨è¿˜ä¼šå¤§å¤§æå‡è¯»çš„é€Ÿåº¦ã€‚

* æ•°æ®å®‰å…¨ï¼šå› ä¸ºæ•°æ®è¢«å¤åˆ¶åˆ°ä»ŽæœåŠ¡å™¨ï¼Œè€Œä¸”ä»ŽæœåŠ¡å™¨å¯ä»¥æš‚åœå¤åˆ¶çš„è¿›ç¨‹ï¼Œå› æ­¤ï¼Œå¯ä»¥åšåˆ°åœ¨ä»ŽæœåŠ¡å™¨ä¸Šè¿è¡Œ **å¤‡ä»½** æœåŠ¡ï¼ŒåŒæ—¶è¿˜ä¸ä¼šç ´åå¯¹åº”çš„ä¸»æœåŠ¡å™¨ä¸Šçš„æ•°æ®ã€‚

* æ•°æ®åˆ†æžï¼šå¯ä»¥åœ¨ä¸»æœåŠ¡å™¨ä¸Šåˆ›å»ºå®žæ—¶æ•°æ®ï¼Œè€Œå¯¹ä¿¡æ¯çš„åˆ†æžå¯ä»¥å‘ç”Ÿåœ¨ä»ŽæœåŠ¡å™¨ï¼Œä¸ä¼šå½±å“ä¸»æœåŠ¡å™¨çš„æ€§èƒ½ã€‚

* è¿œè·ç¦»æ•°æ®åˆ†å¸ƒï¼šå¦‚æžœç”±äºŽå·¥ä½œéœ€è¦ï¼Œå…¬å¸åœ¨è¿œæ–¹çš„åˆ†éƒ¨é—¨éœ€è¦ä¸»æ•°æ®çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œå¯ä»¥åˆ©ç”¨å¤åˆ¶åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªå‰¯æœ¬ï¼Œè€Œæ— éœ€ä¸Žä¸»æœåŠ¡å™¨ä¿æŒæŒç»­çš„è¿žæŽ¥ã€‚







### å¤åˆ¶çš„åˆ†ç±»

åœ¨ä¸¤ä¸ªæœåŠ¡å™¨ä¹‹é—´é…ç½®å¤åˆ¶æœ‰å¾ˆå¤šç§åŠžæ³•ï¼Œä½†æœ€å¥½çš„åŠžæ³•å–å†³äºŽä½¿ç”¨çš„æ•°æ®ä»¥åŠå¼•æ“Žçš„ç±»åˆ«ã€‚

MySQL å¤åˆ¶çš„æ ¼å¼æœ‰ä¸¤ä¸ªæ ¸å¿ƒçš„ç±»åˆ«ï¼š

* åŸºäºŽ **è¯­å¥** çš„å¤åˆ¶ï¼šSBRï¼ŒStatement Based Replicationã€‚ä¹Ÿç§°é€»è¾‘å¤åˆ¶ï¼Œå®ƒä¼šå¤åˆ¶å…¨éƒ¨ SQL è¯­å¥ã€‚å¯ç”¨äºŽ MySQL 3.23 ç‰ˆæœ¬ã€‚
* åŸºäºŽ **è¡Œ** çš„å¤åˆ¶ï¼šRBRï¼ŒRow Based Replicationã€‚åªå¤åˆ¶å‘ç”Ÿä¿®æ”¹çš„è¡Œã€‚å¯ç”¨äºŽ MySQL 5.1 ç‰ˆæœ¬ã€‚

ä¸ºäº†å™è¿°çš„ç®€ä¾¿å’Œé˜…è¯»çš„æ–¹ä¾¿ï¼Œä¸‹æ–‡ç»å¸¸æŠŠ â€œåŸºäºŽè¡Œçš„å¤åˆ¶â€ ç®€ç§°ä¸º â€œ**è¡Œå¤åˆ¶**â€ï¼ŒæŠŠ â€œåŸºäºŽè¯­å¥çš„å¤åˆ¶â€ ç§°ä¸º â€œ**é€»è¾‘å¤åˆ¶**â€ï¼Œä»…é™æœ¬ç¯‡æ–‡ç« ã€‚
{: .notice--primary}

#### ä¼ ç»Ÿçš„ åŸºäºŽäºŒè¿›åˆ¶æ—¥å¿—çš„å¤åˆ¶

æ—©æœŸçš„å¤åˆ¶æ˜¯åŸºäºŽä¸»æœåŠ¡å™¨çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼Œå…¶ä¸­ä¿å­˜äº†ä¸»æœåŠ¡å™¨å¯¹æ•°æ®åº“æ‰€åšçš„ä¿®æ”¹ï¼Œä»ŽæœåŠ¡å™¨è¯»å–è¿™äº›æ—¥å¿—ï¼Œæ®æ­¤æ¥åœ¨è‡ªå·±æœ¬åœ°è¿›è¡ŒåŒæ ·çš„æ“ä½œï¼Œå®žçŽ°æ›´æ–°ã€‚ä»¥ä¸Šæ‰€è¿°çš„ SBR å’Œ RBR å‡å±žäºŽè¿™ç§ï¼Œå‡æ˜¯å¼‚æ­¥å®Œæˆçš„ï¼Œæ„å‘³ç€æœ‰å¯èƒ½ä¸»ä»Žä¹‹é—´ä¼šå­˜åœ¨æ•°æ®åŒæ­¥å»¶è¿Ÿã€‚

ä¸»æœåŠ¡å™¨å°†æ›´æ–°å†™å…¥ **äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶**ï¼Œå¹¶ç»´æŠ¤æ–‡ä»¶çš„ä¸€ä¸ªç´¢å¼•ï¼Œä»¥è·Ÿè¸ªæ—¥å¿—å¾ªçŽ¯ã€‚å½“ä»ŽæœåŠ¡å™¨è¿žæŽ¥ä¸»æœåŠ¡å™¨æ—¶ï¼Œå®ƒä¼šæŠŠè‡ªå·±åœ¨æ—¥å¿—ä¸­è¯»å–çš„æœ€åŽä¸€æ¬¡æˆåŠŸæ›´æ–°çš„ä½ç½®å‘ŠçŸ¥ä¸»æœåŠ¡å™¨ã€‚ä»ŽæœåŠ¡å™¨æŽ¥æ”¶è¯¥ä½ç½®ä¹‹åŽå‘ç”Ÿçš„ä»»ä½•æ›´æ–°ï¼Œç„¶åŽå°é”ï¼Œç­‰å¾…ä¸»æœåŠ¡å™¨é€šçŸ¥æ–°çš„æ›´æ–°ã€‚

#### è¾ƒæ–°çš„ åŸºäºŽ GITD çš„å¤åˆ¶

åœ¨ MySQL 5.6.5 å¼€å§‹åŠä¹‹åŽçš„ç‰ˆæœ¬ä¸­ï¼Œæ”¯æŒäº‹åŠ¡å¤åˆ¶ï¼Œæ˜¯åŸºäºŽå…¨å±€äº‹åŠ¡æ ‡è¯†ç¬¦ï¼Œå³ **GITD**ï¼ŒGlobal Transaction IDentifierã€‚ä½¿ç”¨è¿™ç±»çš„å¤åˆ¶æ—¶ï¼Œæ— éœ€ç›´æŽ¥å¤„ç†æ—¥å¿—æ–‡ä»¶æˆ–å…¶åç§»é‡ï¼Œæžå¤§ç®€åŒ–äº†è®¸å¤šæ—¥å¸¸çš„å¤åˆ¶ä»»åŠ¡ã€‚å› ä¸ºä½¿ç”¨ GTID è¿›è¡Œå¤åˆ¶æ˜¯å®Œå…¨äº‹åŠ¡æ€§çš„ï¼Œåªè¦åœ¨ä¸»æœåŠ¡å™¨ä¸Šæäº¤çš„æ‰€æœ‰äº‹åŠ¡éƒ½å·²åº”ç”¨äºŽä»ŽæœåŠ¡å™¨ï¼Œåˆ™å¯ä»¥ä¿è¯ä¸»ä»Žçš„ä¸€è‡´æ€§ã€‚









### å¤åˆ¶æ‰€è§£å†³çš„é—®é¢˜

å¤åˆ¶é€šå¸¸ç”¨äºŽä»¥ä¸‹æ–¹é¢ï¼š



#### æ•°æ®åˆ†å¸ƒ

MySQL çš„å¤åˆ¶é€šå¸¸å¯¹å¸¦å®½ä¸ç®—æ•æ„Ÿï¼Œå› æ­¤å¯ä»¥ç”¨æ¥è¿œè·ç¦»ç»´æŠ¤æ•°æ®çš„å‰¯æœ¬ï¼Œä¾‹å¦‚åœ¨ä¸åŒçš„æ•°æ®ä¸­å¿ƒä¹‹é—´åŒæ­¥æ•°æ®ã€‚

#### è´Ÿè½½å¹³è¡¡

MySQL çš„å¤åˆ¶æœ‰åŠ©äºŽæŠŠè¯»è¯·æ±‚åˆ†é…åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œè¿™ä¸€ç‚¹å¯¹äºŽè¯»æ•æ„Ÿçš„åº”ç”¨æ¥è¯´ç‰¹åˆ«å¥½ç”¨ã€‚å¯¹ä»£ç åšç®€å•çš„ä¿®æ”¹å°±å¯ä»¥å®žçŽ°åŸºæœ¬çš„è´Ÿè½½å¹³è¡¡ã€‚æ— è®ºæ˜¯ç®€å•çš„è½®è¯¢ DNSï¼Œè¿˜æ˜¯æ›´å¤æ‚çš„æ–¹æ³•ï¼Œéƒ½å¯ä»¥åœ¨ MySQL æœåŠ¡å™¨ä¸Šå¾ˆå¥½åœ°å·¥ä½œã€‚

#### å¤‡ä»½

ä¸»ä»Žåˆ†å¼€éžå¸¸æœ‰åˆ©äºŽå¤‡ä»½çš„ç¨³å®šè¿›è¡Œã€‚

#### é«˜å¯ç”¨ ä¸Ž å¤±æ•ˆåˆ‡æ¢

å¤åˆ¶è¿˜æœ‰åŠ©äºŽé¿å…å•ç‚¹å¤±æ•ˆçš„å‘ç”Ÿï¼Œå¤±æ•ˆåˆ‡æ¢ç³»ç»Ÿå¦‚æžœä½¿ç”¨å¤åˆ¶ï¼Œå¯ä»¥å¤§å¹…å‡å°å½“æœºæ—¶é—´ã€‚

#### MySQL å‡çº§å‰æµ‹è¯•

é€šå¸¸ä¼šåœ¨ä»ŽæœåŠ¡å™¨ä¸Šè¿›è¡Œæ–°ç‰ˆæœ¬ MySQL çš„æµ‹è¯•ï¼Œä»¥ç¡®ä¿æ‰€æœ‰æŸ¥è¯¢éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼Œä¹‹åŽå†å‡çº§æ‰€æœ‰å®žä¾‹ã€‚








### å¤åˆ¶çš„å·¥ä½œåŽŸç†



#### MySQL æ˜¯å¦‚ä½•å¤åˆ¶æ•°æ®çš„

ä»Žé«˜å±‚çº§æ¥çœ‹ï¼Œå¤åˆ¶çš„è¿›ç¨‹åŒ…å«ä¸‰éƒ¨åˆ†ï¼š

1. ä¸»æœåŠ¡å™¨æŠŠä¿®æ”¹ä¿å­˜åˆ°äºŒè¿›åˆ¶æ—¥å¿—ä¸­ï¼Œè¿™äº›è®°å½•ç§°ä¸ºäºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶ã€‚
2. ä»ŽæœåŠ¡å™¨æŠŠä¸»æœåŠ¡å™¨çš„æ—¥å¿—äº‹ä»¶å¤åˆ¶è¿›è‡ªå·±çš„ä¸­ç»§æ—¥å¿—ï¼Œå³ relay logã€‚
3. ä»ŽæœåŠ¡å™¨é‡çŽ°ä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼ŒæŠŠä¿®æ”¹åº”ç”¨åˆ°è‡ªå·±çš„æ•°æ®ä¸­ã€‚

![image-center](/assets/images/mysql.replication.png){: .align-center}

##### ä¸»æœåŠ¡å™¨ä¿å­˜äºŒè¿›åˆ¶æ—¥å¿—

ä¸»æœåŠ¡å™¨ä¸Šï¼ŒMySQL åœ¨æ¯ä¸ªæ›´æ–°æ•°æ®çš„äº‹åŠ¡å¼€å§‹ä¹‹å‰ï¼Œä¼š **æå‰** æŠŠå³å°†å‘ç”Ÿçš„ä¿®æ”¹è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—é‡Œã€‚å†™å…¥æ—¥å¿—çš„æ“ä½œæ˜¯ **ä¸²è¡Œ** çš„ï¼Œå³ä½¿å¦‚æžœäº‹åŠ¡ä¸­çš„è¯­å¥åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯äº¤é”™è¿›è¡Œçš„ã€‚å†™å®Œä»¥åŽï¼Œä¸»æœåŠ¡å™¨ä¼šå‘Šè¯‰å­˜å‚¨å¼•æ“ŽåŽ»æäº¤äº‹åŠ¡ã€‚

##### ä»ŽæœåŠ¡å™¨æ‹·è´äºŒè¿›åˆ¶æ—¥å¿—

ä»ŽæœåŠ¡å™¨å¯åŠ¨ä¸€ä¸ªå·¥äººçº¿ç¨‹ï¼Œ**I/O slave**ï¼Œå®ƒä¼šä¸Žä¸»æœåŠ¡å™¨æ‰“å¼€ä¸€ä¸ªæ™®é€šçš„å®¢æˆ·ç«¯è¿žæŽ¥ï¼Œç„¶åŽåœ¨ä¸»æœåŠ¡å™¨ä¸Šå¯åŠ¨ä¸€ä¸ªç‰¹æ®Šçš„çº¿ç¨‹ï¼Œ**binlog dump** çº¿ç¨‹ï¼Œå®ƒä¼šä»Žä¸»æœåŠ¡å™¨çš„äºŒè¿›åˆ¶æ—¥å¿—ä¸­ **è¯»å–äº‹ä»¶**ã€‚å®ƒå¹¶ä¸ä¼šå¯¹äº‹ä»¶è¿›è¡Œè½®è¯¢ã€‚å¦‚æžœå‘çŽ°å·²ç»åŒæ­¥ï¼Œå®ƒä¼šè¿›å…¥ä¼‘çœ ï¼Œç­‰å¾…äº§ç”Ÿæ–°äº‹ä»¶æ—¶ï¼Œä¸»æœåŠ¡å™¨å‘å…¶å‘é€ä¿¡å·ã€‚ç„¶åŽï¼ŒI/O çº¿ç¨‹æŠŠè¯»å–åˆ°çš„äº‹ä»¶å†™å…¥ä»ŽæœåŠ¡å™¨çš„ä¸­ç»§æ—¥å¿—ã€‚

##### äº‹ä»¶é‡æ¼”

**SQL slave** çº¿ç¨‹ä»Žä¸­ç»§æ—¥å¿—ä¸­è¯»å–å¹¶é‡æ¼”äº‹ä»¶ï¼Œä»Žè€Œæ›´æ–°ä»ŽæœåŠ¡å™¨çš„æ•°æ®ï¼Œä¸Žä¸»æœåŠ¡å™¨å®Œå…¨åŒ¹é…ã€‚åªè¦ SQL slave çº¿ç¨‹èƒ½ä¸Ž I/O çº¿ç¨‹ä¿æŒåŒæ­¥ï¼Œä¸­ç»§æ—¥å¿—é€šå¸¸ä¼šä¿æŒåœ¨æ“ä½œç³»ç»Ÿçš„ç¼“å­˜ä¸­ï¼Œå› æ­¤å…¶å¼€é”€å¾ˆå°‘ã€‚å¦‚æžœæœ‰éœ€è¦ï¼Œå¯ä»¥æŠŠ SQL çº¿ç¨‹æ‰€æ‰§è¡Œçš„äº‹ä»¶ä¿å­˜åˆ°ä»ŽæœåŠ¡å™¨è‡ªå·±çš„äºŒè¿›åˆ¶æ—¥å¿—ä¸­ã€‚

åœ¨ä»ŽæœåŠ¡å™¨ä¸Šï¼Œè¿™ç§å¤åˆ¶çš„æž¶æž„ **æ‹†åˆ†** äº†èŽ·å–ä¸Žé‡æ¼”äº‹ä»¶çš„è¿‡ç¨‹ï¼Œä»Žè€Œå¯ä»¥å®žçŽ°äºŒè€…çš„ **å¼‚æ­¥**ã€‚å³ï¼ŒI/O çº¿ç¨‹å¯ä»¥ç‹¬ç«‹äºŽ SQL çº¿ç¨‹è¿è¡Œã€‚åŒæ—¶ï¼Œå¤åˆ¶çš„è¿›ç¨‹ä¹Ÿå—åˆ°ä¸€å®šçš„çº¦æŸï¼Œå…¶ä¸­æœ€é‡è¦çš„çº¦æŸå°±æ˜¯ï¼š**å¤åˆ¶åœ¨ä»ŽæœåŠ¡å™¨ä¸Šæ˜¯ä¸²è¡Œçš„**ã€‚è¿™å°±æ„å‘³ç€å³ä½¿åœ¨ä¸»æœåŠ¡å™¨ä¸Šå¯ä»¥å¹¶è¡Œç”¨å¤šä¸ªçº¿ç¨‹åŒæ—¶æ›´æ–°ï¼Œåœ¨ä»ŽæœåŠ¡å™¨ä¸Šå´æ— æ³•å®žçŽ°å¹¶è¡Œï¼Œå› ä¸ºæ‰€æœ‰æ›´æ–°éƒ½æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œçš„ã€‚è¿™ä¸€ç‚¹å¯¹äºŽè®¸å¤šå·¥ä½œè´Ÿè½½æ¥è¯´æ˜¯ä¸ªç“¶é¢ˆï¼Œéœ€è¦å¦å¤–è§£å†³ï¼Œä¸è¿‡å¯¹äºŽå¤§å¤šæ•°ç”¨æˆ·æ¥è¯´ï¼Œä¸€ä¸ªçº¿ç¨‹å°±å¤Ÿç”¨äº†ã€‚
{: .notice}





























## å¤åˆ¶çš„é…ç½®

è™½ç„¶å¤åˆ¶çš„é…ç½®ç›¸å½“ç®€å•ï¼Œä½†åœ¨åŸºæœ¬æ­¥éª¤ä¸Šè¿˜æœ‰å¾ˆå¤šå˜åŒ–ï¼Œå–å†³äºŽå…·ä½“çš„å®žæ–½åœºæ™¯ã€‚æœ€åŸºæœ¬çš„åœºæ™¯æ˜¯æ–°å®‰è£…çš„ä¸»ä»ŽæœåŠ¡å™¨ã€‚ä»Žé«˜å±‚çº§æ¥çœ‹ï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š

1. åœ¨æ¯ä¸ªæœåŠ¡å™¨ä¸Šé…ç½®å¤åˆ¶çš„å¸æˆ·
2. é…ç½®ä¸»ä»ŽæœåŠ¡å™¨
3. ä»ŽæœåŠ¡å™¨è¿žæŽ¥åˆ°ä¸»æœåŠ¡å™¨è¿›è¡Œå¤åˆ¶


è¿™æ˜¯åœ¨å‡è®¾é»˜è®¤é…ç½®å°±èƒ½æ»¡è¶³å·¥ä½œçš„åŸºç¡€ä¸Šçš„ï¼Œäº‹å®žä¹Ÿæ˜¯å¦‚æ­¤ã€‚æ–°å®‰è£…äº†ä¸»ä»ŽæœåŠ¡å™¨æ—¶ï¼Œå®ƒä»¬æ‹¥æœ‰ç›¸åŒçš„æ•°æ®ï¼Œå³é»˜è®¤çš„ mysql æ•°æ®åº“ã€‚






### åˆ›å»ºå¤åˆ¶å¸æˆ·

MySQL æœ‰å‡ ä¸ªç‰¹æ®Šçš„æƒé™æ˜¯ç”¨äºŽå¤åˆ¶è¿›ç¨‹çš„ï¼Œä»ŽæœåŠ¡å™¨ä¸Šçš„ I/O çº¿ç¨‹ä¼šä¸Žä¸»æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ª TCP/IP è¿žæŽ¥ã€‚å› æ­¤ï¼Œå¿…é¡»åœ¨ä¸»æœåŠ¡å™¨ä¸Š **åˆ›å»º** ä¸€ä¸ªç”¨æˆ·å¸æˆ·ï¼Œ**èµ‹äºˆ** é€‚å½“ **æƒé™**ï¼Œè¿™æ ·ï¼ŒI/O çº¿ç¨‹æ‰å¯ä»¥ç”¨è¯¥ç”¨æˆ·çš„èº«ä»½è¿žæŽ¥è¿‡åŽ»ï¼Œè¯»å–äºŒè¿›åˆ¶æ—¥å¿—ã€‚

åˆ›å»ºå¸æˆ· replï¼Œå¹¶ä¸ºå…¶èµ‹äºˆæƒé™ï¼š

```sql
mysql> CREATE USER 'repl'@'192.168.0.%' IDENTIFIED BY 'password';
mysql> GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.*
-> TO 'repl'@'192.168.0.%';
```

åœ¨ä¸»ä»ŽæœåŠ¡å™¨ä¸Šéƒ½è¦åˆ›å»ºåŒæ ·çš„ç”¨æˆ·ã€‚









### é…ç½®ä¸»ä»Ž


#### ä¸»æœåŠ¡å™¨

éœ€è¦åœ¨ä¸»æœåŠ¡å™¨ä¸Š **å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—**ï¼Œå¹¶ **æŒ‡å®šæœåŠ¡å™¨ ID**ã€‚

```bash
$ cat /etc/my.cnf

log_bin=/var/log/mysql/mysql-bin.log
server_id=10
```

`server_id` å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œé€šå¸¸é¿å…ç”¨ 1ï¼Œå› ä¸º 1 æ˜¯é»˜è®¤å€¼ï¼Œé¿å…æ··æ·†ã€‚é€šå¸¸ä¼šä½¿ç”¨è¯¥æœåŠ¡å™¨ IP åœ°å€çš„æœ€åŽä¸€æ®µã€‚

é…ç½®å¥½ä»¥åŽéœ€è¦ **é‡å¯ mysqld**ï¼Œç„¶åŽç™»é™†è¿›åŽ»ï¼ŒæŸ¥çœ‹ä»¥ **ç¡®è®¤** äºŒè¿›åˆ¶æ—¥å¿—å·²ç»ç”Ÿæˆï¼š

```sql
mysql> SHOW MASTER STATUS;
+------------------+----------+--------------+------------------+-------------------+
| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
+------------------+----------+--------------+------------------+-------------------+
| mysql-bin.000001 |      634 |              |                  |                   |
+------------------+----------+--------------+------------------+-------------------+
1 row in set (0.00 sec)
```


#### ä»ŽæœåŠ¡å™¨

ä»ŽæœåŠ¡å™¨ä¸Šéœ€è¦è¿›è¡Œç±»ä¼¼çš„é…ç½®ï¼ŒåŒæ ·ä¹Ÿéœ€è¦é‡å¯ mysqldã€‚

```bash
$ cat /etc/my.cnf

log_bin=/var/log/mysql/mysql-bin.log
server_id=2
relay_log=/var/log/mysql/mysql-relay.log
log_slave_updates=1
````

å…¶ä¸­ `log_slave_updates` è¡¨ç¤ºæŠŠå¤åˆ¶è¿‡æ¥çš„äº‹ä»¶ä¹Ÿæ›´æ–°åˆ°è‡ªå·±çš„äºŒè¿›åˆ¶æ—¥å¿—ä¸­ã€‚









### å¯åŠ¨ä»ŽæœåŠ¡å™¨

ä¸‹ä¸€æ­¥å°±æ˜¯å‘Šè¯‰ä»ŽæœåŠ¡å™¨å¦‚ä½•è¿žæŽ¥åˆ°ä¸»æœåŠ¡å™¨ï¼Œå¹¶å¼€å§‹å¯¹äºŒè¿›åˆ¶æ—¥å¿—è¿›è¡Œé‡æ¼”ã€‚


#### æŒ‡å®šä¸»æœåŠ¡å™¨

æ­¤æ—¶ä¸è¦ä½¿ç”¨é…ç½®æ–‡ä»¶æ¥åšï¼Œè€Œéœ€è¦ä½¿ç”¨ `CHANGE MASTER TO` è¯­å¥ï¼Œå®ƒä¼šè¦†ç›–é…ç½®æ–‡ä»¶ä¸­å¯¹åº”çš„è®¾ç½®ã€‚

è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œ**å¯åŠ¨å¤åˆ¶**ï¼š

```sql
mysql> CHANGE MASTER TO MASTER_HOST='server1',
    -> MASTER_USER='repl',
    -> MASTER_PASSWORD='password',
    -> MASTER_LOG_FILE='mysql-bin.000001',
    -> MASTER_LOG_POS=0;
```

`server1` ä¸ºä¸»æœåŠ¡å™¨çš„ä¸»æœºå

`MASTER_LOG_POS=0` å› ä¸ºè¿™æ˜¯æ—¥å¿—çš„å¼€å¤´


#### æŸ¥çœ‹ä»ŽæœåŠ¡å™¨çŠ¶æ€

è¿è¡Œä»¥ä¸Šå‘½ä»¤ä»¥åŽï¼Œå°±å¯ä»¥æŸ¥çœ‹ä»ŽæœåŠ¡å™¨çš„çŠ¶æ€äº†ï¼Œä»Žè€Œç¡®è®¤é…ç½®æ˜¯å¦æ­£ç¡®ï¼š

```sql
mysql> SHOW SLAVE STATUS\G
*************************** 1. row ***********
Slave_IO_State:
Master_Host: server1
Master_User: repl
Master_Port: 3306
Connect_Retry: 60
Master_Log_File: mysql-bin.000001
Read_Master_Log_Pos: 4
Relay_Log_File: mysql-relay-bin.000001
Relay_Log_Pos: 4
Relay_Master_Log_File: mysql-bin.000001
Slave_IO_Running: No
Slave_SQL_Running: No
...omitted...
Seconds_Behind_Master: NULL
```

æ³¨æ„ï¼Œæ­¤æ—¶ I/O å’Œ SQL çº¿ç¨‹éƒ½å°šæœªå¯åŠ¨ï¼Œå…¶è¿è¡ŒçŠ¶æ€å‡ä¸º NOã€‚`Seconds_Behind_Master` æ­¤æ—¶æ˜¯ NULLï¼Œæ„å‘³ç€ä¸çŸ¥é“è‡ªå·±ä¸Žä¸»æœåŠ¡å™¨çš„æ•°æ®çš„æ›´æ–°æ˜¯å¦æœ‰å»¶è¿Ÿã€‚



#### å¯åŠ¨å¤åˆ¶

```sql
mysql> START SLAVE;
```


#### å†æ¬¡æŸ¥çœ‹çŠ¶æ€

```sql
mysql> SHOW SLAVE STATUS\G
*************************** 1. row ******************
Slave_IO_State: Waiting for master to send event
Master_Host: server1
Master_User: repl
Master_Port: 3306
Connect_Retry: 60
Master_Log_File: mysql-bin.000001
Read_Master_Log_Pos: 164
Relay_Log_File: mysql-relay-bin.000001
Relay_Log_Pos: 164
Relay_Master_Log_File: mysql-bin.000001
Slave_IO_Running: Yes
Slave_SQL_Running: Yes
...omitted...
Seconds_Behind_Master: 0
```

æ­¤æ—¶ï¼ŒI/O å’Œ SQL çº¿ç¨‹å‡å·²å¯åŠ¨ï¼Œ`Seconds_Behind_Master` ä¸å†æ˜¯ NULLï¼ŒI/O çº¿ç¨‹ç­‰å¾…ä¸»æœåŠ¡å™¨çš„äº‹ä»¶ï¼Œæ„å‘³ç€ä»ŽæœåŠ¡å™¨å·²ç»åŒæ­¥äº†ä¸»æœåŠ¡å™¨çš„äºŒè¿›åˆ¶æ—¥å¿—ã€‚æ—¥å¿—çš„ä½ç½®å·²ç»å¢žåŠ ï¼Œè¡¨æ˜Žå–å›žäº†ä¸€äº›äº‹ä»¶å¹¶æ‰§è¡Œäº†ã€‚å¦‚æžœåœ¨ä¸»æœåŠ¡å™¨ä¸Šå‘ç”Ÿäº†ä¿®æ”¹ï¼Œåœ¨ä»ŽæœåŠ¡å™¨ä¸Šä¹Ÿä¼šçœ‹åˆ°ç›¸åº”çš„å˜åŒ–ã€‚

##### åœ¨ä¸»æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹ Binlog Dump çº¿ç¨‹

åœ¨ä¸»æœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥çœ‹åˆ°ç”± I/O çº¿ç¨‹åˆ›å»ºçš„è¿žæŽ¥ï¼Œå³ Binlog Dump çº¿ç¨‹ï¼š

```sql
mysql> SHOW PROCESSLIST\G
*************************** 1. row ***************************
Id: 55
User: repl
Host: replica1.webcluster_1:54813
db: NULL
Command: Binlog Dump
Time: 610237
State: Has sent all binlog to slave; waiting for binlog to be updated
Info: NULL
```

##### åœ¨ä»ŽæœåŠ¡å™¨ä¸ŠæŸ¥çœ‹ I/O çº¿ç¨‹ å’Œ SQL çº¿ç¨‹

```sql
mysql> SHOW PROCESSLIST\G
*************************** 1. row ***************************
Id: 1
User: system user
Host:
db: NULL
Command: Connect
Time: 611116
State: Waiting for master to send event
Info: NULL
*************************** 2. row ***************************
Id: 2
User: system user
Host:
db: NULL
Command: Connect
Time: 33
State: Has read all relay log; waiting for the slave I/O thread to update it
Info: NULL
```

ä»ŽæœåŠ¡å™¨ä¸Šçš„ I/O å’Œ SQL è¿™ä¸¤ä¸ªçº¿ç¨‹å§‹ç»ˆæ˜¯ç”¨ system user å¸æˆ·æ¥è¿è¡Œçš„ã€‚å½“ SQL çº¿ç¨‹é‡æ¼”äº‹ä»¶æ—¶ï¼Œ`Info` å­—æ®µä¼šæ˜¾ç¤ºå½“å‰æ‰§è¡Œçš„æŸ¥è¯¢å†…å®¹ã€‚











### åœ¨å¦ä¸€ä¸ªæœåŠ¡å™¨ä¸Šåˆå§‹åŒ–ä»ŽæœåŠ¡å™¨

å®žé™…ç”Ÿäº§ä¸­å¾€å¾€ä¸ä¼šä½¿ç”¨æ–°è£…çš„æœåŠ¡å™¨æ¥é…ç½®ï¼Œå¾€å¾€æ˜¯è¿è¡Œäº†å¥½ä¹…çš„æœåŠ¡å™¨ï¼Œé€šå¸¸åœ¨ä¸»ä»ŽæœåŠ¡å™¨ä¸Šçš„æ•°æ®ï¼Œä¸€å¼€å§‹ä¹Ÿä¸ä¼šåŒæ­¥ã€‚

åˆå§‹æ—¶æŠŠæ•°æ®ä»Žä¸»æœåŠ¡å™¨å¤åˆ¶åˆ°ä»ŽæœåŠ¡å™¨æœ‰å¾ˆå¤šæ–¹æ³•ï¼šç›´æŽ¥å¤åˆ¶ï¼Œä»Žå¦ä¸€ä¸ªä»ŽæœåŠ¡å™¨å¤åˆ¶ï¼Œç”¨æœ€è¿‘çš„å¤‡ä»½å¼€å§‹å¤åˆ¶ã€‚

æ€»ä¹‹ï¼Œè¦æƒ³åœ¨åˆå§‹åŒ–æ—¶è®©ä»ŽæœåŠ¡å™¨çš„æ•°æ®ä¸Žä¸»æœåŠ¡å™¨åŒæ­¥ï¼Œéœ€è¦ä¸‰æ ·ä¸œè¥¿ï¼š

* ä¸»æœåŠ¡å™¨æŸä¸ªæ—¶é—´ç‚¹çš„å¿«ç…§
* ä¸»æœåŠ¡å™¨å½“å‰çš„æ—¥å¿—æ–‡ä»¶ï¼Œä»¥åŠåœ¨æ‰€é‡‡ç”¨å¿«ç…§å…¶æ—¶é—´ç‚¹ä¸Šè¯¥æ—¥å¿—çš„åç§»é‡ï¼Œç”¨ log file coordinates æ¥è¡¨ç¤ºè¿™ä¸¤ä¸ªå€¼ï¼Œå®ƒä»¬æ ‡è¯†äº†äºŒè¿›åˆ¶æ—¥å¿—ä¸­çš„ä¸€ä¸ªå…·ä½“çš„ä½ç½®ã€‚å¯ä»¥ç”¨ `SHOW MASTER STATUS` æ¥æŸ¥çœ‹è¿™ä¸¤ä¸ªå€¼ã€‚
* ä¸»æœåŠ¡å™¨çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ï¼Œä»Žå¿«ç…§æ—¶é—´ç‚¹ä¸€ç›´åˆ°çŽ°åœ¨çš„å†…å®¹



#### ä»Žå…¶å®ƒæœåŠ¡å™¨å¤åˆ¶æ•°æ®çš„æ–¹æ³•

##### ç¦»çº¿å¤åˆ¶

ç”Ÿæˆä»ŽæœåŠ¡å™¨æœ€åŸºæœ¬çš„æ–¹æ³•ï¼š

* å…³é—­ä¸»æœåŠ¡å™¨ï¼ŒæŠŠå…¶ä¸­çš„æ–‡ä»¶å¤åˆ¶åˆ°ä»ŽæœåŠ¡å™¨
* é‡å¯ä¸»æœåŠ¡å™¨ï¼Œå¼€å§‹ä¸€ä¸ªæ–°çš„äºŒè¿›åˆ¶æ—¥å¿—
* åœ¨ä»ŽæœåŠ¡å™¨ä¸Šé…ç½® `CHANGE MASTER TO`ï¼Œä»ŽäºŒè¿›åˆ¶æ—¥å¿—çš„å¼€å¤´å¼€å§‹å¤åˆ¶

##### åœ¨çº¿å¤åˆ¶

å¦‚æžœåªä½¿ç”¨ MyISAM è¡¨ï¼Œå¯ä»¥ç”¨ `mysqlhotcopy` æˆ– `rsync` æ¥åœ¨çº¿å¤åˆ¶æ–‡ä»¶ï¼Œæ— éœ€å…³é—­ä¸»æœåŠ¡å™¨ã€‚

##### ä½¿ç”¨ `mysqldump`

å¦‚æžœåªä½¿ç”¨ InnoDB è¡¨ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤ä»Žä¸»æœåŠ¡å™¨ä¸Šå¤åˆ¶æ‰€æœ‰å†…å®¹ï¼Œå°†å…¶åŠ è½½åˆ°ä»ŽæœåŠ¡å™¨ä¸­ï¼Œå¹¶æŠŠä»ŽæœåŠ¡å™¨çš„åæ ‡ä¿®æ”¹åˆ°ä¸»æœåŠ¡å™¨äºŒè¿›åˆ¶æ—¥å¿—çš„å¯¹åº”ä½ç½®ä¸Šï¼š

```bash
$ mysqldump --single-transaction --all-databases --master-data=1--host=server1 \
| mysql --host=server2
```

`--single-transaction` é€‰é¡¹ä¼šè®©å¤åˆ¶è¿›ç¨‹ä»¥æ•°æ®åœ¨äº‹åŠ¡å¼€å§‹æ—¶çš„çŠ¶æ€æ¥è¯»å–å®ƒä»¬ï¼Œå¦‚æžœæ²¡æœ‰ä½¿ç”¨äº‹åŠ¡æ€§è¡¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ `--lock-all-tables` é€‰é¡¹æ¥é”å®šï¼Œä»Žè€Œå¾—åˆ°æ‰€æœ‰è¡¨çš„ä¸€è‡´çš„å¤æœ¬ã€‚

##### ä½¿ç”¨å¿«ç…§æˆ–å¤‡ä»½

åªè¦çŸ¥é“å¯¹åº”çš„äºŒè¿›åˆ¶æ—¥å¿—çš„åæ ‡ï¼Œå°±å¯ä»¥ä½¿ç”¨å¿«ç…§æˆ–å¤‡ä»½ä»Žä¸»æœåŠ¡å™¨ä¸­åˆå§‹åŒ–å¤åˆ¶ã€‚ç›´æŽ¥æŠŠå¤‡ä»½æˆ–å¿«ç…§æ¢å¤åˆ°ä»ŽæœåŠ¡å™¨ä¸Šï¼Œç„¶åŽåœ¨ `CHANGE MASTER TO` ä¸­ä½¿ç”¨é€‚å½“çš„äºŒè¿›åˆ¶æ—¥å¿—åæ ‡ã€‚

##### ä»Žå…¶å®ƒä»ŽæœåŠ¡å™¨

è¿˜å¯ä»¥ç”¨ä¸Šé¢æåˆ°çš„å¿«ç…§åŠå…¶å®ƒæ–¹æ³•ï¼Œä»Žå¦ä¸€å°ä»ŽæœåŠ¡å™¨ä¸Šæ¥å¤åˆ¶æ•°æ®ã€‚ä½†æ˜¯ï¼Œå¦‚æžœä½¿ç”¨ `mysqldump`ï¼Œ`--master-data` é€‰é¡¹æ˜¯ä¸èµ·ä½œç”¨çš„ã€‚

å¦å¤–ï¼Œéœ€è¦ä½¿ç”¨ `SHOW SLAVE STATUS` æ¥æŸ¥çœ‹å…·ä½“çš„ä½ç½®ï¼Œå³è¯¥å¿«ç…§å»ºç«‹æ—¶ï¼Œä»ŽæœåŠ¡å™¨æ­£åœ¨æ‰§è¡Œå“ªäº›äº‹ä»¶ã€‚

ä»Žå¦ä¸€ä¸ªä»ŽæœåŠ¡å™¨å¤åˆ¶æ•°æ®çš„æœ€å¤§ç¼ºç‚¹ï¼šå¦‚æžœè¿™ä¸ªä»ŽæœåŠ¡å™¨æ²¡æœ‰å®ŒæˆåŒæ­¥ï¼Œåˆ™å†æ¬¡ç”Ÿæˆçš„ä»ŽæœåŠ¡å™¨å¾—åˆ°çš„æ•°æ®ä¸€æ ·æ˜¯æ²¡æœ‰åŒæ­¥çš„ã€‚

ç»å¯¹ä¸è¦ä½¿ç”¨ `LOAD DATA FROM MASTER` æˆ– `LOAD TABLE FROM MASTER`ï¼Œè¿™äº›è¯­å¥å·²ç»æ·˜æ±°äº†ï¼Œç»ä»¬ä¸ä»…è¿è¡Œç¼“æ…¢ï¼Œè¿˜éžå¸¸å±é™©ï¼Œè€Œä¸”åªé€‚ç”¨äºŽ MyISAMã€‚













### æŽ¨èçš„å¤åˆ¶é…ç½®


#### å¼ºåˆ¶åŒæ­¥æ—¥å¿—åˆ°ç£ç›˜

åœ¨ **ä¸»æœåŠ¡å™¨** ä¸Šï¼Œå…³äºŽäºŒè¿›åˆ¶æ—¥å¿—æœ€é‡è¦çš„è®¾ç½®æ˜¯ `sync_binlog`ï¼š

```conf
sync_binlog=1
```

è¯¥é…ç½®è®© MySQL æ¯æ¬¡æäº¤ä¸€ä¸ªäº‹åŠ¡æ—¶ï¼Œéƒ½ä¼šæŠŠäºŒè¿›åˆ¶æ—¥å¿—çš„å†…å®¹ **å¼ºåˆ¶åŒæ­¥åˆ°ç£ç›˜** ä¸­ï¼Œè¿™æ ·å¯ä»¥é¿å…çªç„¶çš„å´©æºƒå¯¼è‡´æ—¥å¿—äº‹ä»¶çš„ä¸¢å¤±ã€‚è¯¥é…ç½®åªé€‚ç”¨äºŽä¸»æœåŠ¡å™¨ï¼Œå› ä¸ºè¯¥é…ç½®åœ¨ä»ŽæœåŠ¡å™¨ä¸Šä¼šäº§ç”Ÿä¸å¿…è¦çš„å¼€é”€ã€‚å®ƒåªé€‚ç”¨äºŽäºŒè¿›åˆ¶æ—¥å¿—ï¼Œä¸é€‚ç”¨ä¸­ç»§æ—¥å¿—ã€‚


#### ä½¿ç”¨ InnoDB

å¦‚æžœæ— æ³•å¿å—ç³»ç»Ÿå´©æºƒå¯¼è‡´è¡¨è¢«ç ´åï¼Œè¿˜æ˜¯æŽ¨èä½¿ç”¨ InnoDBã€‚MyISAM çš„è¡¨åœ¨ç³»ç»Ÿå´©æºƒä¹‹åŽå®¹æ˜“å‡ºçŽ°ä¸ä¸€è‡´ã€‚å¦‚æžœåœ¨ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ä¸­æ²¡æœ‰æ‰§è¡Œå®Œè¯­å¥ï¼Œé‚£ä¹ˆå³ä½¿åœ¨ä¿®å¤äº†è¡¨ä¹‹åŽæ•°æ®ä¹Ÿä¼šä¸ä¸€è‡´ï¼Œè¿™ä¸€å¯èƒ½æ€§æ˜¯å¾ˆå¤§çš„ã€‚

å¦‚æžœä½¿ç”¨ **InnoDB**ï¼Œåˆ™å¼ºçƒˆæŽ¨èåœ¨ **ä¸»æœåŠ¡å™¨** ä¸Šä½¿ç”¨ä»¥ä¸‹é…ç½®ï¼š

```conf
innodb_flush_logs_at_trx_commit=1   # æ¯æ¬¡æäº¤åŽå‡åˆ·æ–°æ—¥å¿—
innodb_support_xa=1   # MySQL 5.0 åŠä»¥åŽç‰ˆæœ¬é€‚ç”¨
innodb_safe_binlog   # ä»… MySQL 4.1 é€‚ç”¨
```

è¿™äº›é…ç½®æ˜¯ MySQL 5.0 åŠä»¥åŽç‰ˆæœ¬çš„é»˜è®¤è®¾ç½®ã€‚


#### æŒ‡å®šç»Ÿä¸€çš„æ—¥å¿—æ–‡ä»¶å

å»ºè®®æ˜¾å¼æŒ‡å®šäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„ **åŸºå‡†å**ï¼Œä»¥ä¾¿åœ¨ **æ‰€æœ‰æœåŠ¡å™¨** ä¸Šåˆ›å»º **ç»Ÿä¸€çš„** äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åã€‚

```conf
log_bin=/var/log/mysql/mysql-bin.log
```


#### æŒ‡å®šä»ŽæœåŠ¡å™¨çš„ä¸­ç»§æ—¥å¿—

åœ¨ä»ŽæœåŠ¡å™¨ä¸­é…ç½®ä»¥ä¸‹å‚æ•°ï¼Œå»ºè®®ç”¨ç»å¯¹è·¯å¾„æŒ‡å®šä¸­ç»§æ—¥å¿—ã€‚

```conf
relay_log=/path/to/logs/relay-bin
skip_slave_start
read_only
```

`relay_log` é€‰é¡¹ç›®çš„æ˜¯ä¸ºäº†é¿å…é»˜è®¤ä½¿ç”¨ä¸»æœºååšä¸­ç»§æ—¥å¿—çš„æ–‡ä»¶åã€‚

`skip_slave_start` æ˜¯ä¸ºäº†é¿å…ä»ŽæœåŠ¡å™¨åœ¨ç»åŽ†å´©æºƒåŽè‡ªåŠ¨å¯åŠ¨ï¼Œä»¥ä¾¿ç»™ç®¡ç†å‘˜ä¿®å¤çš„æœºä¼šã€‚

`read_only` é€‰é¡¹å¯ä»¥é¿å…å¤§å¤šæ•°ç”¨æˆ·ä¿®æ”¹éžä¸´æ—¶è¡¨ã€‚åªå…è®¸ SQL çº¿ç¨‹ä¿®æ”¹ï¼Œä»¥åŠå°‘æ•°å…·æœ‰ SUPER æƒé™çš„ç”¨æˆ·ã€‚å› æ­¤è¦å°½é‡é¿å…ç»™æ™®é€šå¸æˆ·åˆ†é… SUPER æƒé™ã€‚


#### æŠŠä¸­ç»§æ—¥å¿—å’Œ `master.info` å¼ºåˆ¶åŒæ­¥åˆ°ç£ç›˜

å³ä½¿å¯ç”¨äº†ä»¥ä¸Šæ‰€æœ‰é…ç½®ï¼Œä»ŽæœåŠ¡å™¨åœ¨ç»åŽ†å´©æºƒåŽè¿˜æ˜¯å®¹æ˜“å‘ç”ŸæŸåï¼Œå› ä¸ºä¸­ç»§æ—¥å¿—å’Œ `master.info` æ–‡ä»¶æ— æ³•æŠµå¾¡å´©æºƒã€‚å®ƒä»¬ç”šè‡³é»˜è®¤ä¸ä¼šè¢«åŒæ­¥åˆ°ç£ç›˜ï¼Œç›´åˆ° MySQL 5.5 ç‰ˆæœ¬æ‰æœ‰å¯¹åº”çš„é…ç½®é€‰é¡¹æ¥æŽ§åˆ¶è¯¥åˆ·æ–°è¡Œä¸ºã€‚

å¦‚æžœä½¿ç”¨çš„æ˜¯ MySQL 5.5 ä»¥åŽçš„ç‰ˆæœ¬ï¼Œè€Œä¸”ä¸åœ¨æ„é¢å¤–çš„ `fsync()` è°ƒç”¨æ‰€äº§ç”Ÿçš„æ€§èƒ½å¼€é”€ï¼Œåˆ™å»ºè®®ä»¥ä¸‹é…ç½®ï¼š

```conf
sync_master_info = 1
sync_relay_log = 1
sync_relay_log_info = 1
```






























## æ·±å…¥äº†è§£å¤åˆ¶







### åŸºäºŽè¯­å¥çš„å¤åˆ¶

MySQL 5.0 åŠè¾ƒæ—©ç‰ˆæœ¬åªæ”¯æŒé€»è¾‘å¤åˆ¶ã€‚

åœ¨ä¸»æœåŠ¡å™¨ä¸Šï¼ŒæŠŠå¯¼è‡´æ•°æ®å˜åŒ–çš„ **æŸ¥è¯¢** ä¿å­˜åˆ°æ—¥å¿—ä¸­ã€‚



#### ä¼˜ç‚¹

* éƒ¨ç½²ç®€å•ï¼šæœ¬åœ°ä¿å­˜æ—¥å¿—ï¼Œå¼‚åœ°é‡æ¼”ï¼Œå³å®ŒæˆåŒæ­¥ã€‚
* æ—¥å¿—äº‹ä»¶æ¯”è¾ƒç®€æ´ï¼šç›¸å¯¹æ¥è¯´ï¼Œä¸ä¼šå ç”¨å¤ªå¤šå¸¦å®½ã€‚
* æ—¥å¿—æ–‡ä»¶åŒ…å«æ›´æ”¹ç›¸å…³çš„æ‰€æœ‰è¯­å¥ï¼Œå¯ä»¥ç”¨æ¥å®¡æ ¸æ•°æ®åº“ã€‚

å½“ä¸»ä»ŽæœåŠ¡å™¨çš„ **æ•°æ®æ ¼å±€æœ‰æ‰€ä¸åŒ** æ—¶ï¼Œé€»è¾‘å¤åˆ¶æ›´åŠ é€‚ç”¨ã€‚ä¾‹å¦‚ï¼Œä¸»ä»ŽæœåŠ¡å™¨ä¸Šçš„è¡¨ä¸åŒï¼Œä½†æ•°æ®ç±»ä¼¼æ˜¯å…¼å®¹çš„ï¼Œæˆ–è€…å­—æ®µçš„é¡ºåºä¹Ÿæœ‰æ‰€ä¸åŒç­‰ç­‰ã€‚é€»è¾‘å¤åˆ¶ä½¿å¾—åœ¨ä»ŽæœåŠ¡å™¨ä¸Šå¯¹æ•°æ®æ ¼å±€çš„ä¿®æ”¹æ›´åŠ å®¹æ˜“ï¼Œå‡å°‘å½“æœºæ—¶é—´ã€‚é€»è¾‘å¤åˆ¶åœ¨æ“ä½œä¸Šæœ‰æ›´å¤§çš„çµæ´»æ€§ã€‚

é€»è¾‘å¤åˆ¶ä¸­ï¼Œé‡æ¼”çš„è¿‡ç¨‹å¤§ä½“ä¸Šæ˜¯æ™®é€šçš„ SQL æ“ä½œï¼Œæ‰€æœ‰çš„å˜åŒ–æ˜¯ä»¥ä¸€ä¸ªå®¹æ˜“ç†è§£çš„æœºåˆ¶å‘ç”Ÿçš„ï¼Œæ›´å®¹æ˜“æ£€æŸ¥å’Œåˆ¤æ–­å½“ä¸‹å‘ç”Ÿäº†ä»€ä¹ˆã€‚



#### ç¼ºç‚¹

##### æŸäº›è¯­å¥æ— æ³•å¤åˆ¶

åœ¨å®žé™…ä½¿ç”¨ä¸­ï¼Œé€»è¾‘å¤åˆ¶å¹¶æ²¡æœ‰çœ‹èµ·æ¥é‚£ä¹ˆç®€å•ã€‚é™¤äº†æŸ¥è¯¢æ–‡æœ¬ä¹‹å¤–ï¼Œä¸»æœåŠ¡å™¨ä¸Šçš„è®¸å¤šå˜åŒ–è¿˜å†³å®šäºŽå…¶å®ƒå› ç´ ã€‚ä¾‹å¦‚ï¼Œè¿™äº›è¯­å¥åœ¨ä¸»æœåŠ¡å™¨å’Œä»ŽæœåŠ¡å™¨ä¸Šå¯èƒ½æ‰§è¡Œçš„æ¬¡æ•°ä¼šä¸åŒï¼Œç»“æžœå°±æ˜¯ï¼ŒMySQL äºŒè¿›åˆ¶æ—¥å¿—çš„æ ¼å¼ä¸­é™¤äº†æŸ¥è¯¢æ–‡æœ¬ä¹‹å¤–ï¼Œè¿˜ä¼šåŒ…æ‹¬å‡ ä½å…ƒæ•°æ®ï¼Œå¦‚å½“å‰çš„æ—¶é—´æˆ³ã€‚å³ä¾¿å¦‚æ­¤ï¼Œä»ç„¶æœ‰ **ä¸€äº›è¯­å¥æ˜¯ MySQL æ— æ³•æ­£ç¡®å¤åˆ¶çš„**ï¼Œæ¯”å¦‚ä½¿ç”¨ `CURRENT_USER()` å‡½æ•°çš„æŸ¥è¯¢ï¼Œä»¥åŠ **é¢„å‚¨ç¨‹åº** å’Œ **è§¦å‘å™¨**ã€‚

åº•çº¿ï¼šå¦‚æžœè¦ä½¿ç”¨è§¦å‘å™¨æˆ–é¢„å‚¨ç¨‹åºï¼Œå°±ä¸è¦ä½¿ç”¨é€»è¾‘å¤åˆ¶ã€‚


##### ä¿®æ”¹å¿…é¡»æ˜¯åºåˆ—åŒ–çš„

é€»è¾‘å¤åˆ¶è¦æ±‚å¯¹æ•°æ®çš„ä¿®æ”¹å¿…é¡»æ˜¯åºåˆ—åŒ–çš„ï¼Œå³çº¿æ€§çš„ã€‚è¿™å°±ä¼š **éœ€è¦æ›´å¤šçš„é”å®š**ï¼Œæœ‰æ—¶ç®€ç›´æ˜¯å¤ªå¤šäº†ã€‚ä¸æ˜¯æ‰€æœ‰çš„å­˜å‚¨å¼•æ“Žéƒ½èƒ½ä¸Žé€»è¾‘å¤åˆ¶é…åˆä½¿ç”¨çš„ã€‚










### åŸºäºŽè¡Œçš„å¤åˆ¶

ä»Ž MySQL 5.1 å¼€å§‹æ”¯æŒè¡Œå¤åˆ¶ï¼Œåœ¨äºŒè¿›åˆ¶æ—¥å¿—ä¸­è®°å½•æ•°æ®çš„çœŸå®žä¿®æ”¹ï¼Œæ›´åƒå¤§å¤šæ•°å…¶å®ƒæ•°æ®åº“äº§å“çš„å¤åˆ¶æ‰‹æ®µã€‚


#### ä¼˜ç‚¹

##### æ‰€æœ‰çš„ä¿®æ”¹éƒ½èƒ½æ­£ç¡®å¤åˆ¶ï¼Œæ›´åŠ å®‰å…¨

æœ‰äº›ä¿®æ”¹è¿˜å¯ä»¥å¤åˆ¶çš„æ›´åŠ é«˜æ•ˆï¼Œå› ä¸ºä»ŽæœåŠ¡å™¨ **ä¸å¿…é‡æ¼”** åœ¨ä¸»æœåŠ¡å™¨ä¸Šå¼•èµ·è¡Œå˜åŒ–çš„é‚£ä¸ª **æŸ¥è¯¢**ã€‚

å¾ˆå°‘æœ‰è¡Œå¤åˆ¶ä¸èƒ½èƒœä»»çš„æƒ…å†µï¼Œæ‰€æœ‰çš„ SQL ç»“æž„ã€è§¦å‘å™¨ã€é¢„å‚¨ç¨‹åºç­‰ï¼Œå®ƒéƒ½èƒ½æ­£ç¡®å¤„ç†ã€‚åªæœ‰åœ¨è¿›è¡Œä¸€äº›å¾ˆæ™ºèƒ½åŒ–çš„æ“ä½œæ—¶æ‰ä¼šæœ‰äº›å±€ä¿ƒï¼Œå¦‚ä¿®æ”¹æ•°æ®æ ¼å±€ã€‚

##### ä¸»ä»ŽæœåŠ¡å™¨ä¸Šåªéœ€è¦å¾ˆå°‘çš„é”å®šï¼Œå› æ­¤æœ‰æ›´é«˜çš„å¹¶å‘

è¡Œå¤åˆ¶ä¸éœ€è¦ç‰¹åˆ«å¼ºçš„åºåˆ—åŒ–å°±å¯ä»¥å®Œæˆé‡æ¼”ã€‚

##### æ—¥å¿—è®°å½•æ›´åŠ ç›´æŽ¥

è¡Œå¤åˆ¶åœ¨æ—¥å¿—ä¸­æ‰€è®°å½•çš„æ˜¯ **å‘ç”Ÿå˜åŒ–çš„æ•°æ®æœ¬èº«**ï¼Œå› æ­¤äºŒè¿›åˆ¶æ—¥å¿—ä¸­çš„è®°å½•å°±æ˜¯åœ¨ä¸»æœåŠ¡å™¨ä¸ŠçœŸå®žå‘ç”Ÿçš„å˜åŒ–å†…å®¹ã€‚ä¸éœ€è¦æ ¹æ®è¯­å¥æ¥çŒœæµ‹å®ƒä¿®æ”¹äº†ä»€ä¹ˆæ•°æ®ã€‚å› æ­¤ï¼Œç”¨è¡Œå¤åˆ¶èƒ½å¤Ÿ **æ›´åŠ äº†è§£å“ªäº›æ•°æ®å‘ç”Ÿäº†å˜åŒ–**ï¼Œå¯¹å˜åŒ–çš„è®°å½•ä¹Ÿæ›´å¥½ã€‚

##### å¯ä»¥è®°å½•åŽ†å²æ•°æ®

å¦å¤–ï¼Œåœ¨æŸäº›æƒ…å†µäº”ï¼Œè¡Œå¤åˆ¶çš„äºŒè¿›åˆ¶æ—¥å¿—è¿˜ä¼šè®°å½• **åŽ†å²æ•°æ®**ï¼Œå¯¹äºŽæ•°æ®çš„æ¢å¤ç‰¹åˆ«æœ‰å¸®åŠ©ã€‚

##### å¯¹ CPU çš„éœ€æ±‚ä¸å¤§

åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œè¡Œå¤åˆ¶å¯¹ CPU çš„éœ€æ±‚ä¸å¤§ï¼Œå› ä¸ºå®ƒä¸éœ€è¦åƒé€»è¾‘å¤åˆ¶é‚£æ ·è®¡åˆ’å’Œæ‰§è¡ŒæŸ¥è¯¢ã€‚

##### æœ‰åŠ©äºŽè§£å†³æ•°æ®ä¸ä¸€è‡´

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¡Œå¤åˆ¶æœ‰åŠ©äºŽæ›´å¿«åœ°æŸ¥æ‰¾å¹¶è§£å†³æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚

ä¾‹å¦‚ï¼Œå¦‚æžœåœ¨ä¸»æœåŠ¡å™¨ä¸Šæ›´æ–°äº†ä¸€è¡Œï¼Œä½†ä»ŽæœåŠ¡å™¨ä¸Šæ ¹æœ¬å°±æ²¡æœ‰è¿™ä¸€è¡Œï¼Œæ­¤æ—¶é€»è¾‘å¤åˆ¶ä¸ä¼šå¤±è´¥ï¼Œè€Œè¡Œå¤åˆ¶å°±ä¼š **æŠ¥é”™å¹¶åœæ­¢**ã€‚


##### èŒƒä¾‹

**å¯¹æŸ¥è¯¢çš„é‡æ¼”æœ‰æ—¶ä¼šå¼•èµ·å¾ˆå¤§çš„å¼€é”€**ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹è¿™ä¸ªæŸ¥è¯¢æ˜¯ä»Žä¸€ä¸ªå·¨å¤§çš„è¡¨ä¸­è¯»å–ä¸€äº›ç»Ÿè®¡ä¿¡æ¯ï¼Œä¿å­˜åˆ°ä¸€ä¸ªå°è¡¨é‡Œï¼š

```sql
mysql> INSERT INTO summary_table(col1, col2, sum_col3)
	-> SELECT col1, col2, sum(col3)
	-> FROM enormous_table
	-> GROUP BY col1, col2;
```

å‡è®¾åœ¨ `enormous_table` è¡¨ä¸­ï¼Œ`col1` å’Œ `col2` çš„ç»„åˆåªæœ‰ä¸‰ç§ï¼Œè¯¥æŸ¥è¯¢ä¼šæ‰«ææºè¡¨ä¸­çš„è®¸å¤šè¡Œï¼Œè€Œåœ¨ç›®æ ‡è¡¨ä¸­ä¿å­˜çš„ç»“æžœå´åªæœ‰ä¸‰è¡Œã€‚æŠŠè¯¥äº‹ä»¶åšä¸ºè¯­å¥å¤åˆ¶ä¼šä½¿ä»ŽæœåŠ¡å™¨é‡å¤æ‰€æœ‰è¿™äº›æ“ä½œï¼Œè€Œç›®çš„åªæ˜¯ä¸ºäº†ç”Ÿæˆä¸‰è¡Œæ•°æ®ï¼Œè€Œå¦‚æžœä½¿ç”¨è¡Œå¤åˆ¶å°±è¦ç®€å•çš„å¤šäº†ï¼Œæ›´åŠ é«˜æ•ˆã€‚

ðŸ˜ˆ ä»Žä¸Šä¾‹å¯ä»¥çœ‹å‡ºï¼Œæ˜¯å“ªäº›è¯­å¥ä½¿ç”¨è¡Œå¤åˆ¶æ‰ä¼šæ›´åŠ é«˜æ•ˆå‘¢ï¼Ÿå½“ç„¶æ˜¯ä»Žæ•°æ®ä¿®æ”¹çš„ç»“æžœå‡ºå‘æ¥çœ‹äº†ï¼Œåªè¦æ˜¯ä½¿ç”¨è¯­å¥å¤§å¼ æ——é¼“åœ°è¿›è¡ŒæŸ¥è¯¢ï¼Œå¾—åˆ°çš„ç»“æžœå´åªæ˜¯å¯¹å°‘æ•°çš„å‡ è¡Œæ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œæ­¤æ—¶ç”¨è¡Œå¤åˆ¶å°±æ›´é«˜æ•ˆã€‚
{: .notice--success}





#### ç¼ºç‚¹

å› ä¸ºæ—¥å¿—äº‹ä»¶ä¸­ä¸åŒ…å«è¯­å¥ï¼Œå› æ­¤ **å¾ˆéš¾äº†è§£æ‰§è¡Œäº†å“ªäº› SQL è¯­å¥**ï¼Œæœ‰æ—¶å€™è¿™å¾ˆé‡è¦ã€‚

å¤åˆ¶æ¥çš„å˜åŒ–åœ¨ä»ŽæœåŠ¡å™¨ä¸­åº”ç”¨æ—¶ï¼Œæ˜¯ä»¥å®Œå…¨ä¸åŒçš„æ–¹å¼è¿›è¡Œçš„ï¼Œå®ƒæ‰§è¡Œçš„æ ¹æœ¬ä¸æ˜¯ SQL è¯­å¥ã€‚äº‹å®žä¸Šï¼Œè¡Œå¤åˆ¶åº”ç”¨ä¿®æ”¹çš„è¿‡ç¨‹æ˜¯åœ¨ **é»‘ç®±** ä¸­è¿›è¡Œçš„ï¼Œè°éƒ½çœ‹ä¸åˆ°æœåŠ¡å™¨åšäº†ä»€ä¹ˆï¼Œè¿™æ–¹é¢çš„æ–‡æ¡£ä¹Ÿä¸å¤Ÿè¯¦ç»†ã€‚

åœ¨ä½¿ç”¨å¤šçº§ä»ŽæœåŠ¡å™¨æ—¶ï¼Œå¦‚æžœå®ƒä»¬ä½¿ç”¨ç›¸åŒçš„é…ç½®çš„è¡Œå¤åˆ¶ã€‚å‡è®¾åœ¨ä¼šè¯çº§å˜é‡ `@@binlog_format` ä¸º STATEMENT çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œäº†ä¸€æ¡è¯­å¥ï¼Œä¼šåœ¨å‘èµ·è¯¥è¯­å¥çš„æœåŠ¡å™¨ä¸Šï¼Œä»¥è¯­å¥çš„å½¢å¼è®°å½•åœ¨æ—¥å¿—ä¸­ã€‚ä½†æ˜¯ï¼Œç¬¬ä¸€çº§ä»ŽæœåŠ¡å™¨ä¼šæŠŠè¯¥äº‹ä»¶ä»¥è¡Œå¤åˆ¶çš„æ ¼å¼ä¸­ç»§ä¸‹æ¥ï¼Œä¼ é€’ç»™å¤åˆ¶é“¾ä¸Šçš„å…¶å®ƒä»ŽæœåŠ¡å™¨ã€‚è¿™æ ·ï¼Œç”¨æˆ·æœ¬æ¥å¸Œæœ›åœ¨æ—¥å¿—ä¸­ä»¥è¯­å¥çš„æ ¼å¼è®°å½•ï¼Œå¯æ˜¯è¯¥äº‹ä»¶ç©¿è¶Šå¤åˆ¶æ‹“æ‰‘æ—¶ï¼Œè¿˜æ˜¯è¢« **å¼ºè¡Œåˆ‡æ¢** æˆäº†è¡Œå¤åˆ¶ã€‚

æœ‰äº›æ“ä½œï¼Œé€»è¾‘å¤åˆ¶åº”ä»˜çš„æ¥ï¼Œä½†è¡Œå¤åˆ¶ä¸è¡Œï¼Œæ¯”å¦‚åœ¨ä»ŽæœåŠ¡å™¨ä¸Šä¿®æ”¹æ•°æ®æ ¼å±€ã€‚
















### å“ªç§å¤åˆ¶æ–¹æ³•æ›´å¥½ï¼Ÿ

å› ä¸ºæ¯ç§å¤åˆ¶çš„æ–¹æ³•éƒ½æœ‰æœ€é€‚åˆè‡ªå·±çš„å…·ä½“æƒ…å†µï¼ŒMySQL å¯ä»¥åœ¨é€»è¾‘å¤åˆ¶å’Œè¡Œå¤åˆ¶è¿™ä¸¤ç§æ–¹æ³•ä¹‹é—´ **åŠ¨æ€åˆ‡æ¢**ã€‚é»˜è®¤æ˜¯ä½¿ç”¨é€»è¾‘å¤åˆ¶ï¼Œå½“å‘çŽ°æŸä¸ªäº‹ä»¶æ— æ³•ç”¨è¯­å¥æ­£ç¡®å¤åˆ¶æ—¶ï¼Œå®ƒä¼šåˆ‡æ¢æˆè¡Œå¤åˆ¶ã€‚å½“ç„¶ï¼Œåœ¨éœ€è¦æ—¶ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æŽ§åˆ¶ä½¿ç”¨å“ªç§æ–¹æ³•ï¼Œé€šè¿‡é…ç½®ä¼šè¯å˜é‡ `binlog_format` æ¥å®žçŽ°ã€‚

ç†è®ºä¸Šï¼Œè¡Œå¤åˆ¶å¯èƒ½æ•´ä½“æ¥è¯´æ›´å¥½ä¸€äº›ï¼Œè€Œä¸”åœ¨å®žé™…ç”Ÿäº§ä¸­å¯¹äºŽå¤§å¤šæ•°äººæ¥è¯´å·¥ä½œçš„æ¯”è¾ƒå¥½ã€‚
















### å¤åˆ¶ä¼šç”¨åˆ°çš„æ–‡ä»¶

é™¤äº†äºŒè¿›åˆ¶æ—¥å¿—å’Œä¸­ç»§æ—¥å¿—ï¼Œè¿˜æœ‰ä¸€äº›æ–‡ä»¶æ˜¯åœ¨å¤åˆ¶è¿‡ç¨‹ä¸­ä¼šç”¨åˆ°çš„ã€‚MySQL ä¼šæ ¹æ®å½“å‰çš„é…ç½®æ¥å¤„ç†è¿™äº›æ–‡ä»¶ã€‚ä¸åŒç‰ˆæœ¬çš„ MySQLï¼Œæ”¾ç½®è¿™äº›æ–‡ä»¶çš„é»˜è®¤ä½ç½®å¯èƒ½æ‰€æœ‰ä¸åŒã€‚



#### `mysql-bin.index`

å¯ç”¨äº†äºŒè¿›åˆ¶æ—¥å¿—ä»¥åŽï¼ŒæœåŠ¡å™¨ä¸­è¿˜ä¼šå­˜åœ¨ä¸Žå…¶åŒåçš„æ–‡ä»¶ï¼Œä½†åŠ äº† `.index` åŽç¼€ã€‚è¯¥æ–‡ä»¶ä¼šè·Ÿè¸ªç£ç›˜ä¸­çš„äºŒè¿›åˆ¶æ—¥å¿—ã€‚å®ƒä¸Žè¡¨æ ¼ç´¢å¼•ä¸åŒï¼Œæ–‡ä»¶ä¸­çš„æ¯ä¸€è¡ŒåŒ…å«äº†ä¸€ä¸ª **äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶å**ã€‚

MySQL ä¾èµ–è¿™ä¸ªç´¢å¼•æ–‡ä»¶æ¥å®šä½äºŒè¿›åˆ¶æ—¥å¿—ï¼Œæ‰€ä»¥ä¸è¦æ‰‹åŠ¨å¹²é¢„å®ƒã€‚

```bash
$ sudo cat /var/log/mysqld/mysql-bin.index
/var/log/mysqld/mysql-bin.000001
/var/log/mysqld/mysql-bin.000002
/var/log/mysqld/mysql-bin.000003
/var/log/mysqld/mysql-bin.000004
/var/log/mysqld/mysql-bin.000005
```



#### `mysql-relay-bin.index`

MySQL ä¾èµ–è¿™ä¸ªç´¢å¼•æ–‡ä»¶æ¥å®šä½ä¸­ç»§æ—¥å¿—ã€‚

```bash
$ sudo cat /var/log/mysql/mysql-relay-bin.index
/var/log/mysql/mysql-relay-bin.000005
```



#### `master.info`

è¯¥æ–‡ä»¶ä¿å­˜çš„æ˜¯ **ä¸»æœåŠ¡å™¨çš„è¯¦ç»†ä¿¡æ¯**ï¼Œä»ŽæœåŠ¡å™¨æ ¹æ®è¯¥æ–‡ä»¶ä¸­çš„ä¿¡æ¯æ¥è¿žæŽ¥åˆ°ä¸»æœåŠ¡å™¨ã€‚MySQL ä¾èµ–å®ƒæ¥è¿žæŽ¥ä¸»æœåŠ¡å™¨ã€‚

è¯¥æ–‡ä»¶ä¸­åŒ…å«ä»ŽæœåŠ¡å™¨ç”¨æˆ·çš„å¯†ç ï¼Œæ˜¯æ˜Žæ–‡ä¿å­˜çš„ï¼Œå› æ­¤æœ‰å¿…è¦å¯¹æƒé™åŠ ä»¥é™åˆ¶ã€‚



#### `relay-log.info`

è¯¥æ–‡ä»¶åŒ…å«äº†ä»ŽæœåŠ¡å™¨ä¸­åœ¨äºŒè¿›åˆ¶æ—¥å¿—å’Œä¸­ç»§æ—¥å¿—ä¸­çš„ **åæ ‡**ã€‚MySQL ä¾èµ–å®ƒæ¥äº†è§£è®°èµ·ä¹‹å‰å¤åˆ¶åˆ°ä»€ä¹ˆä½ç½®ã€‚




>ç”¨è¿™äº›æ–‡ä»¶æ¥è®°å½•å¤åˆ¶å’Œæ—¥å¿—çš„çŠ¶æ€ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒç²—ç³™çš„åŠžæ³•ã€‚è€Œä¸”ä¸å¹¸çš„æ˜¯ï¼Œå®ƒä»¬è¿˜ä¸æ˜¯åŒæ­¥å†™å…¥çš„ï¼Œæ‰€ä»¥å¦‚æžœèµ¶ä¸ŠæœåŠ¡å™¨çªç„¶æ–­ç”µï¼Œè¿™äº›æ–‡ä»¶è¿˜æ²¡æœ‰è¢«åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼ŒæœåŠ¡å™¨é‡å¯æ—¶ï¼Œè¿™äº›æ–‡ä»¶çš„å†…å®¹å¯èƒ½å°±ä¸æ˜¯æ­£ç¡®çš„ã€‚åœ¨ MySQL 5.5 ä¹‹åŽå·²ç»æœ‰æ‰€æ”¹è¿›ï¼Œå³å‰é¢æåˆ°çš„å¯¹ `sync_*` çš„é…ç½®ã€‚
>
>`.index` æ–‡ä»¶ä¼šä¸Žå¦ä¸€ä¸ªé…ç½®äº¤äº’ï¼Œå³ `expire_logs_days`ï¼Œè¯¥å‚æ•°ç”¨äºŽå®šä¹‰ MySQL åº”è¯¥å¦‚ä½•åˆ é™¤è¿‡æœŸçš„äºŒè¿›åˆ¶æ—¥å¿—ã€‚å¦‚æžœ `mysql-bin.index` æ–‡ä»¶ä¸­æ‰€æŒ‡å®šçš„æ–‡ä»¶åœ¨ç£ç›˜ä¸Šä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆ é™¤åœ¨æŸäº›ç‰ˆæœ¬çš„ MySQL ä¸­å°±ä¼šä¸ç®¡ç”¨ã€‚äº‹å®žä¸Šï¼Œå³ä½¿ç”¨ `PURGE MASTER LOGS` è¯­å¥éƒ½æ— æ³•åˆ é™¤ã€‚è§£å†³åŠžæ³•é€šå¸¸æ˜¯ç”¨ MySQL æœåŠ¡å™¨æ¥ç®¡ç†äºŒè¿›åˆ¶æ—¥å¿—ã€‚æ€»ä¹‹ä¸è¦æ‰‹åŠ¨ `rm` åˆ é™¤è¿™äº›æ–‡ä»¶ï¼Œä»¥å…å½±å“å®ƒä»¬çš„æ­£å¸¸è¿è¡Œã€‚
>
>
