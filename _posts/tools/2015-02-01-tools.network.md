---
toc: true
toc_label: "Linux çš„ä½¿ç”¨ - ç½‘ç»œ"
toc_icon: "laptop"
title: "Linux çš„ä½¿ç”¨ - ç½‘ç»œ"
tags: linux ç½‘ç»œ IPåœ°å€
categories: "tools"
classes: wide
excerpt: ""
header:
  overlay_image: /assets/images/header/linux.jpg
  overlay_filter: rgba(0, 0, 0, 0.6)
---





## æŸ¥çœ‹ç½‘ç»œè®¾å¤‡ä¿¡æ¯

æœ¬æ–‡ä¸­ï¼ŒèŒƒä¾‹å‡åœ¨è¯´æ˜æ–‡å­—çš„ **ä¸‹æ–¹**ã€‚



### ç½‘å¡




#### `lspci`

å¯ä»¥æŸ¥çœ‹ç½‘å¡çš„å“ç‰Œå’Œå‹å·ï¼š

```bash
# lspci | grep -i 'eth'
02:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168B PCI Express Gigabit Ethernet controller (rev 06)
```



#### `ethtool`

è¯¥å·¥å…·ç”¨äºæŸ¥è¯¢æˆ–æ§åˆ¶ç½‘ç»œé©±åŠ¨ä»¥åŠç¡¬ä»¶çš„è®¾ç½®ã€‚

ä¸åŠ å‚æ•°è¿è¡Œä¸ºæŸ¥çœ‹æŸä¸ªç½‘å¡æ¥å£çš„è¯¦ç»†ä¿¡æ¯ã€‚

```bash
$ ethtool ens33
Settings for ens33:
        Supported ports: [ TP ]
        Supported link modes:   10baseT/Half 10baseT/Full
                                100baseT/Half 100baseT/Full
                                1000baseT/Full  # æ”¯æŒåƒå…†åŒå·¥
        Supported pause frame use: No
        Supports auto-negotiation: Yes  # æ”¯æŒè‡ªé€‚åº”
        Advertised link modes:  10baseT/Half 10baseT/Full
                                100baseT/Half 100baseT/Full
                                1000baseT/Full
        Advertised pause frame use: No
        Advertised auto-negotiation: Yes  # é»˜è®¤ä½¿ç”¨è‡ªé€‚åº”æ¨¡å¼
        Speed: 1000Mb/s  # å½“å‰ç½‘å¡å·¥ä½œé€Ÿåº¦
        Duplex: Full  #  å…¨åŒå·¥
        Port: Twisted Pair
        PHYAD: 0
        Transceiver: internal
        Auto-negotiation: on
        MDI-X: off (auto)
Cannot get wake-on-lan settings: Operation not permitted
        Current message level: 0x00000007 (7)
                               drv probe link
        Link detected: yes  # å½“å‰æœ‰ç½‘çº¿è¿æ¥
```










### æŸ¥çœ‹ç½‘ç»œæ¥å£




#### `ifconfig -a`

æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£çš„å±æ€§ï¼Œæ— è®ºåœ¨çº¿è¿˜æ˜¯ç¦»çº¿ã€‚

```bash
$ ifconfig -a
ens33: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.1.77  netmask 255.255.255.0  broadcast 192.168.1.255
......

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
......
```




#### `ip link show`

æŸ¥çœ‹æ•°æ®é“¾è·¯å±‚å½“å‰å¯ç”¨è®¾å¤‡ä¿¡æ¯ã€‚

```bash
$ ip link show
1: lo: <LOOPBACK> mtu 16436 qdisc noqueue state DOWN
link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000
link/ether b8:97:5a:17:b3:8f brd ff:ff:ff:ff:ff:ff
```














































## ç®¡ç†ç½‘ç»œé…ç½®





### ä¸»æœºå




#### é™æ€ä¸»æœºå

static hostname

**é™æ€ä¸»æœºå** æ˜¯ç³»ç»Ÿå¯åŠ¨æ—¶å†…æ ¸ä¼šå¼•ç”¨çš„é»˜è®¤ä¸»æœºåï¼Œ**é€šå¸¸å…³æ³¨** è¿™ä¸ªä¸»æœºåå³å¯ã€‚å®ƒé€šå¸¸ä¿å­˜åœ¨ `/etc/hostname` æ–‡ä»¶ä¸­ã€‚


##### æŸ¥çœ‹

æŸ¥çœ‹é™æ€ä¸»æœºåï¼š

```bash
$ hostnamectl status
Static hostname: localhost
Transient hostname: localhost.localdomain
	  Icon name: computer-container
		Chassis: container
	 Machine ID: c02dd0f0a9b74c00b232d39819dbff61
		Boot ID: a4dbaa87203040858654e13e0cc00376
 Virtualization: openvz
Operating System: CentOS Linux 7 (Core)
	CPE OS Name: cpe:/o:centos:centos:7
		 Kernel: Linux 2.6.32-042stab127.2
   Architecture: x86-64
```

```bash
$ nmcli general hostname
localhost
```  

```bash
$ hostname
localhost
```

##### ä¿®æ”¹

ğŸ ä¿®æ”¹é™æ€ä¸»æœºåï¼š

```bash
nmcli general hostname MATRIX
```

```bash
hostnamectl set-hostname "Your-Hostname"
```




#### åŠ¨æ€ä¸»æœºå

`transient` ï¼šç”±å†…æ ¸ç»´æŠ¤çš„åŠ¨æ€ä¸»æœºåï¼Œç³»ç»Ÿå¯åŠ¨å **é»˜è®¤ä¸é™æ€ä¸»æœºåç›¸åŒ**ã€‚ä½†åœ¨ **è¿è¡Œæ—¶**ï¼Œå¯è¢« DHCP æˆ– mDNS ä¿®æ”¹ã€‚

ä¿®æ”¹åŠ¨æ€ä¸»æœºåï¼š

```bash
hostnamectl --transient set-hostname BILL
```




#### pretty hostname

è¿™ç§ä¸»æœºååªæ˜¯ç»™ç”¨æˆ·çœ‹çš„ï¼Œå†…æ ¸å®Œå…¨ç”¨ä¸åˆ°ã€‚å¯ä»¥æ˜¯ä»»æ„æ ¼å¼ UTF8 å­—ç¬¦ã€‚













### ç½‘å¡å‘½å

ä¸»æµç½‘å¡ä½¿ç”¨ä»¥å¤ªç½‘ç»œåè®®ï¼Œç§°è¿™ç§ç½‘ç»œæ¥å£ä¸º eth0 ç­‰ã€‚

CentOS 7 å¼€å§‹ï¼Œä½¿ç”¨æ–°è§„åˆ™å¯¹ç½‘å¡çš„å‘½åï¼š

* eno1 ï¼šä¸»æ¿å†…ç½®çš„ç½‘å¡
* ens1 ï¼šä¸»æ¿å†…ç½®çš„ PCI-E æ¥å£çš„ç½‘å¡
* enp2s0 ï¼šPCI-E æ¥å£çš„ç‹¬ç«‹ç½‘å¡ï¼Œå¯èƒ½æœ‰å¤šä¸ªæ¥å£ï¼Œs0, s1...
* eth0 ï¼šå¦‚æœä¸Šè¿°åç§°éƒ½ä¸é€‚ç”¨ï¼Œå°±ç”¨é»˜è®¤ç½‘å¡ç¼–å·

ç”¨ `ifconfig -a` ä¼šåˆ—å‡ºå…¨éƒ¨ç½‘å¡ã€‚CentOS 7 ä¸å¸Œæœ›ç”¨æˆ·æ‰‹åŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè€Œåº”è¯¥ä½¿ç”¨ `nmcli` å‘½ä»¤æ¥è®¾ç½®ç½‘ç»œå‚æ•°ã€‚










### è¿æ¥

connection

NetworkManager æŠŠæ‰€æœ‰çš„ç½‘ç»œé…ç½®æ–‡ä»¶éƒ½ä¿å­˜ä¸ºä¸€ä¸ªä¸ªçš„ â€œè¿æ¥â€ï¼Œå› æ­¤ **è¿æ¥ä¸­æ‰€ä¿å­˜çš„å®é™…ä¸Šæ˜¯äºŒå±‚ä¿¡æ¯ã€IP åœ°å€ç­‰æ•°æ®**ï¼Œè¿™äº›æ•°æ®å…±åŒæè¿°äº†åˆ›å»ºå¹¶è¿æ¥åˆ°ç½‘ç»œçš„å…·ä½“æ–¹å¼ã€‚è¿æ¥çš„ç”Ÿæˆä¸ä½¿ç”¨çŠ¶æ€å‡ç”± NetworkManager æ§åˆ¶ã€‚
{: .notice--success}

å½“ä¸€ä¸ªç½‘ç»œæ¥å£ä½¿ç”¨æŸä¸ªè¿æ¥çš„é…ç½®æ¥åˆ›å»ºè¿æ¥æˆ–è¿æ¥åˆ°ç½‘ç»œæ—¶ï¼Œæˆ‘ä»¬è¯´ä¸€ä¸ªè¿æ¥å¤„äº **æ¿€æ´»**ï¼ˆactiveï¼‰çŠ¶æ€ã€‚

ä¸€ä¸ªç½‘ç»œæ¥å£ï¼ˆdeviceï¼‰å¯ä»¥æœ‰ **å¤šä¸ªè¿æ¥**ï¼Œä½† **åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªè¢«æ¿€æ´»**ã€‚

ä¹‹æ‰€ä»¥ä½¿ç”¨å¤šä¸ªè¿æ¥ï¼Œæ˜¯ä¸ºäº† **å¿«é€Ÿåˆ‡æ¢ä¸åŒçš„ç½‘ç»œé…ç½®**ã€‚

å‡å¦‚æŸå°ä¸»æœºé€šå¸¸è¿æ¥åˆ°ä½¿ç”¨ DHCP çš„ç½‘ç»œï¼Œä½†æœ‰æ—¶éœ€è¦ä½¿ç”¨é™æ€ IP åœ°å€è¿æ¥åˆ°æŸä¸ªæµ‹è¯•ç½‘ç»œï¼Œè¿™ä¸¤ç§æƒ…å†µçš„ç½‘ç»œè®¾ç½®å¯ä»¥åˆ†åˆ«ä¿å­˜ä¸ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ¯æ¬¡åˆ‡æ¢é…ç½®æ–‡ä»¶å°±å¯ä»¥ç›´æ¥åˆ‡æ¢ IP åœ°å€çš„è®¾ç½®äº†ã€‚

ä½œä¸ºè¿æ¥çš„è¿™äº›é…ç½®æ–‡ä»¶é€šå¸¸ä¿å­˜åœ¨ `/etc/sysconfig/network-scripts/` ç›®å½•ï¼Œæ–‡ä»¶åå‰ç¼€ä¸º **`ifcfg-`** å¼€å¤´ã€‚

â€œè¿æ¥â€ ä¸€è¯ **ä»…åœ¨æœ¬å°èŠ‚** ç”¨æ¥ä¸“æŒ‡è¿™ç§ **ç½‘ç»œé…ç½®æ–‡ä»¶**ã€‚å…¶å®ƒå°èŠ‚å‡ºç°çš„è¿æ¥å‡æŒ‡é€šå¸¸è¯­ä¹‰ä¸­çš„ç½‘ç»œè¿æ¥ã€‚
{: .notice}




#### å¯ç”¨ã€ç¦ç”¨å…¨å±€ç½‘ç»œ

å¯ç”¨ã€ç¦ç”¨ç½‘ç»œã€‚ç½‘ç»œè¢«ç¦ç”¨æ—¶ï¼Œæ‰€æœ‰ NM ç®¡ç†çš„æ¥å£éƒ½ä¼šåœç”¨ã€‚

```bash
nmcli networking  on/off
```




#### åˆ›å»ºè¿æ¥

```
nmcli connection add type ... ifname ... con-name ...
```


##### `type` è¿æ¥ç±»å‹

`type` çš„å–å€¼å¯ä»¥æ˜¯ï¼š

1.  `ethernet`
2.  `wifi`
3.  `wimax`
4.  `pppoe`
5.  `gsm`
6.  `cdma`
7.  `infiniband`
8.  `bluetooth`
9.  `vlan`
10.  `bond`
11.  `bond-slave`
12.  `team`
13.  `team-slave`
14.  `bridge`
15.  `bridge-slave`
16.  `vpn`
17.  `olpc-mesh`
18.  `adsl`
19.  `tun`
20.  `ip-tunnel`
21.  `macvlan`
22.  `vxlan`
23.  `dummy`


##### `ifname`  æ¥å£åç§°

æŒ‡å®šè¿™ä¸ªæ–°è¿æ¥è¦ä½¿ç”¨å“ªä¸ªæ¥å£ã€‚


##### `con-name` è¿æ¥åç§°

æŒ‡å®šæ–°è¿æ¥çš„åç§°ã€‚å¦‚æœªæŒ‡å®šï¼Œé»˜è®¤å‘½åæ ¼å¼ä¸º `type-ifname[-number]`


##### æ·»åŠ åŠ¨æ€åœ°å€è¿æ¥

```bash
nmcli connection add type ethernet ifname ens33 con-name MATRIX
```

é…ç½®ä¼šä¿å­˜ä¸º `/etc/sysconfig/network-scripts/ifcfg-MATRIX`ã€‚

å†æ¬¡æ¿€æ´»è¯¥æ¥å£ä¹‹å‰ï¼ŒNetworkManager ä¸ä¼šæ„è¯†åˆ°å¯¹ ifcfg æ–‡ä»¶çš„æ‰‹åŠ¨æ›´æ”¹ã€‚è¦æƒ³ç«‹å³ç”Ÿæ•ˆï¼Œå¿…é¡»ä½¿ç”¨ `nmcli con reload`ã€‚
{: .notice--success}


##### æ·»åŠ é™æ€åœ°å€è¿æ¥

```
~]$ nmcli connection add type ethernet con-name LAB ifname ens33 ip4 192.168.1.56/24 gw4 192.168.1.1
~]$ nmcli con add type ethernet con-name LAB ifname ens9 ip4 10.10.10.10/24 gw4 10.10.10.254
```




#### æŸ¥çœ‹è¿æ¥


ğŸ æŸ¥çœ‹æ‰€æœ‰è¿æ¥ï¼š

```
nmcli connection show
```

æŸ¥çœ‹æŒ‡å®šè¿æ¥çš„é…ç½®å‚æ•°ï¼š

```
nmcli connection show ens33
```

ğŸ æŸ¥çœ‹å·²æ¿€æ´»çš„è¿æ¥ï¼š

```
nmcli connection show --active
```




#### å¯ç”¨è¿æ¥

ğŸ å¯ç”¨æŒ‡å®šè¿æ¥ï¼š

```
nmcli connection up id bond0`
```





#### åœç”¨è¿æ¥

åœç”¨è¯¥æ¥å£çš„è¿æ¥ã€‚ä¹‹å **æœ‰å¯èƒ½** è¢«è‡ªåŠ¨è¿æ¥çš„è®¾ç½®æ‰€ **æ¿€æ´»**ã€‚

```
nmcli connection down id port0`
```




#### æŸ¥çœ‹ç½‘ç»œå‚æ•°


##### IP åœ°å€

ğŸ æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£çš„å„åè®®åœ°å€ï¼ŒåŒ…æ‹¬ IP åœ°å€ï¼š

```
ip addr
```  


##### è·¯ç”±è¡¨

ğŸ æŸ¥çœ‹è·¯ç”±è¡¨ï¼š

```
route -n
```




####ã€€ä¿®æ”¹è¿æ¥å‚æ•°

å‘½ä»¤ä¸­ï¼Œ`connection` å¯ä»¥ç®€å†™ä¸º `con`ï¼š


##### ä¸»æœºå

ä¿®æ”¹ â€œè¿æ¥åˆ° DHCP æœåŠ¡å™¨æ—¶â€ ç»™è‡ªå·±é…ç½®çš„ä¸»æœºåã€‚å¦‚è¿æ¥åˆ° WIFI æ—¶ã€‚

```
~]$ nmcli con modify my-office ipv4.dhcp-hostname ZION ipv6.dhcp-hostname ZION
```


##### å®¢æˆ·ç«¯å

ä¿®æ”¹å‘é€åˆ° DHCP æœåŠ¡å™¨çš„ IPv4 å®¢æˆ·ç«¯åç§°ã€‚å¦‚è¿æ¥åˆ° WIFI æ—¶ã€‚

```
~]$ nmcli con modify my-office ipv4.dhcp-client-id neo
```


##### DNS æœåŠ¡å™¨

ğŸ ä¿®æ”¹ DNS æœåŠ¡å™¨åœ°å€ï¼š

```
~]$ nmcli con modify test-lab ipv4.dns "8.8.8.8 8.8.4.4"
~]$ nmcli con modify test-lab ipv6.dns "2001:4860:4860::8888 2001:4860:4860::8844"
```

å¿½ç•¥ DHCP æœåŠ¡å™¨å‘é€åˆ°ä¸»æœºçš„ DNS æœåŠ¡å™¨ï¼š

```
~]$ nmcli con modify my-office ipv4.ignore-auto-dns yes ipv6.ignore-auto-dns yes
```

æ·»åŠ  DNS æœåŠ¡å™¨åœ°å€ï¼š

```
~]$ nmcli con mod test-lab +ipv4.dns "8.8.8.8 8.8.4.4"
~]$ nmcli con mod test-lab +ipv6.dns "2001:4860:4860::8888 2001:4860:4860::8844"
```




##### è·¯ç”±

ğŸ æ·»åŠ é™æ€è·¯ç”±ï¼š

```
~]# nmcli con modify eth0 +ipv4.routes "192.168.122.0/24 10.10.10.1"
```




##### IP åœ°å€

ğŸ ä¿®æ”¹ IPv4 åœ°å€åŠç½‘å…³ï¼š

RHEL 7.0:

```
~]# nmcli con mod net-eth0 ipv4.addresses "192.168.2.10/24 192.168.2.1"
~]# nmcli con mod net-eth0 ipv4.method manual
~]# nmcli con up net-eth0
```

RHEL 7.1 :

```
~]# nmcli con mod net-eth0 ipv4.addresses 192.168.2.10/24
~]# nmcli con mod net-eth0 ipv4.gateway 192.168.2.1
~]# nmcli con mod net-eth0 ipv4.method manual
~]# nmcli con up net-eth0
```

ä¿®æ”¹ IPv4 åœ°å€å’Œç½‘å…³çš„å‘½ä»¤åœ¨ **RHEL 7.0** ç‰ˆæœ¬ä¸­ï¼Œæ•´ä½“éœ€è¦åŒå¼•å·æ‹¬èµ·æ¥ï¼Œå¼•å·å†…éƒ¨å¯ä»¥ç”¨ `IP åœ°å€ + ç©ºæ ¼ + ç½‘å…³` çš„æ ¼å¼ï¼Œä½†åˆ°äº† **RHEL 7.1** ç‰ˆæœ¬ï¼Œå› ä¸º NetworkManager ç‰ˆæœ¬çš„å‡çº§ï¼Œå¯¼è‡´è¯­æ³•ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œåœ°å€å’Œç½‘å…³å¿…é¡» **åˆ†å¼€æŒ‡å®š**ï¼ŒæŒ‡å®šæ—¶æ— éœ€åŒå¼•å·ã€‚
{: .notice--warning}



















### æ¥å£

device

æ¥å£æ˜¯ **ç‰©ç†è®¾å¤‡**ï¼Œä¸€ä¸ªæ¥å£å¯ä»¥æœ‰å¤šä¸ªè¿æ¥ï¼Œä½†æ˜¯ **åŒæ—¶åªå…è®¸ä¸€ä¸ªè¿æ¥å¤„äºæ¿€æ´»çŠ¶æ€**ã€‚

å¯¹ç½‘ç»œæ¥å£çš„æ“ä½œä¸€èˆ¬ç”¨ `nmcli device` æ¥å®ç°ã€‚




#### æŸ¥çœ‹æ¥å£çŠ¶æ€

æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£çš„çŠ¶æ€ï¼š

```bash
$ nmcli device status
DEVICE      TYPE      STATE      CONNECTION
virbr0      bridge    connected  virbr0     
ens33       ethernet  connected  ens33      
lo          loopback  unmanaged  --         
virbr0-nic  tun       unmanaged  --
```

æŸ¥çœ‹æŒ‡å®šæ¥å£çŠ¶æ€ï¼š

```bash
$ nmcli device show ens33
GENERAL.DEVICE:                         ens33
GENERAL.TYPE:                           ethernet
GENERAL.HWADDR:                         00:0C:29:B2:33:63
GENERAL.MTU:                            1500
GENERAL.STATE:                          100 (connected)
GENERAL.CONNECTION:                     ens33
GENERAL.CON-PATH:                       /org/freedesktop/NetworkManager/ActiveConnection/0
WIRED-PROPERTIES.CARRIER:               on
IP4.ADDRESS[1]:                         192.168.1.78/24
IP4.GATEWAY:                            192.168.1.1
IP4.ROUTE[1]:                           dst = 169.254.0.0/16, nh = 0.0.0.0, mt = 1002
IP4.DNS[1]:                             192.168.1.1
IP6.ADDRESS[1]:                         fe80::104b:1122:25f0:e73d/64
IP6.GATEWAY:                            
```




#### è¿æ¥ç½‘ç»œæ¥å£

è¿æ¥æŒ‡å®šçš„ç½‘ç»œæ¥å£ã€‚NetworkManager ä¼šå°è¯•æ‰¾åˆ°ä¸€ä¸ªæœ€é€‚åˆçš„è¿æ¥æ¥æ¿€æ´»ï¼Œå³ä½¿æ²¡æœ‰é…ç½®ä¸ºè‡ªåŠ¨è¿æ¥çš„ä¹Ÿä¼šè€ƒè™‘ã€‚

```bash
$ nmcli device connect ifname
```




#### æ–­å¼€ç½‘ç»œæ¥å£

æ–­å¼€æŒ‡å®šçš„ç½‘ç»œæ¥å£ã€‚æ–­å¼€ä¹‹åï¼Œè¯¥æ¥å£ä¸ä¼šè¢«è¿æ¥è‡ªåŠ¨æ¿€æ´»ã€‚

```bash
$ nmcli device disconnect ifname
```




#### ç›‘æ§ç½‘ç»œæ¥å£

ç›‘æ§è®¾å¤‡çš„æ´»åŠ¨ï¼Œåªè¦è®¾å¤‡çŠ¶æ€æœ‰å˜åŒ–ï¼Œè¯¥å‘½ä»¤å°±ä¼šæ˜¾ç¤ºä¸€è¡Œä¿¡æ¯ã€‚

```bash
$ nmcli device monitor ens33
```




#### WIFI

##### ç¡®è®¤ wifi å·²æ‰“å¼€ï¼Œå¯ç”¨äº†å¹¿æ’­

```bash
~]$ nmcli radio
WIFI-HW  WIFI     WWAN-HW  WWAN    
enabled  enabled  enabled  enabled
```


##### é‡æ–°æ‰«ææ— çº¿ AP

```bash
~]$ nmcli device wifi rescan
```


##### æŸ¥çœ‹æ— çº¿ AP åˆ—è¡¨

```bash
$ nmcli device wifi list
```


##### è¿æ¥åˆ°æŸä¸ª AP

```bash
$ nmcli device wifi connect "SSID" password "wireless-password"
```

è¦æƒ³é¿å…åœ¨å‘½ä»¤è¡Œä¸­ç›´æ¥è¾“å…¥å¯†ç ï¼š

```bash
nmcli --ask device wifi connect "myssid"
```






































## æŸ¥çœ‹ç½‘ç»œçŠ¶æ€











### ä¾¦å¬çŠ¶æ€




#### æŸ¥çœ‹ä¾¦å¬çš„ç«¯å£

`netstat -tnlp`

æŸ¥çœ‹æ‰€æœ‰ç›‘å¬ç«¯å£












### ç½‘ç»œè¿æ¥çŠ¶æ€




#### æŸ¥çœ‹ç³»ç»Ÿæ•´ä½“è¿æ¥


##### `nmcli`

```
$ nmcli general status
STATE      CONNECTIVITY  WIFI-HW  WIFI     WWAN-HW  WWAN    
connected  full          enabled  enabled  enabled  enabled
```

æŸ¥çœ‹ç³»ç»Ÿæœ‰çº¿ã€æ— çº¿è¿æ¥çŠ¶æ€ã€‚

```
$ sudo nmcli networking connectivity check
full
```

æ£€æŸ¥ç³»ç»Ÿå½“å‰è¿æ¥çŠ¶æ€ã€‚

è¿”å›çš„ç½‘ç»œè¿æ¥çš„çŠ¶æ€ï¼š

* `none`  ä¸»æœºæœªè¿æ¥åˆ°ä»»ä½•ç½‘ç»œ
* `portal`  ä¸»æœºä½äºç½‘å…³çš„åé¢ï¼Œæ— æ³•è®¿é—®å®Œæ•´çš„äº’è”ç½‘
* `limited`  ä¸»æœºè¿æ¥åˆ°æŸä¸ªç½‘ç»œï¼Œä½†æ— æ³•è®¿é—®äº’è”ç½‘
* `full`  ä¸»æœºè¿æ¥åˆ°æŸä¸ªç½‘ç»œï¼Œå¹¶å¯è®¿é—®äº’è”ç½‘
* `unknown`  æ— æ³•æŸ¥æ˜è¿æ¥çŠ¶æ€


##### `netstat`

```
netstat -antp
```  

æŸ¥çœ‹æ‰€æœ‰å·²å»ºç«‹çš„è¿æ¥

```
netstat -s
```

æŸ¥çœ‹æ¯ä¸ªåè®®çš„ç®€è¦ç»Ÿè®¡æ•°æ®ã€‚





































## `nmcli` å·¥å…·

CentOS7 ä¹‹å‰çš„ç½‘ç»œç®¡ç†æ˜¯é€šè¿‡ `ifcfg` æ–‡ä»¶é…ç½®ç®¡ç†æ¥å£ï¼Œè€Œç°åœ¨æ˜¯é€šè¿‡ NetworkManager æœåŠ¡ç®¡ç†è¿æ¥ã€‚
{: .notice}

åœ¨ CentOS7 ä¸­é»˜è®¤ä½¿ç”¨ **NetworkManager** å®ˆæŠ¤è¿›ç¨‹æ¥ç›‘æ§å’Œç®¡ç†ç½‘ç»œè®¾ç½®ã€‚`nmcli` æ˜¯å‘½ä»¤è¡Œçš„ NetworkManager å·¥å…·ï¼Œä¼šè‡ªåŠ¨æŠŠé…ç½®å†™åˆ° `/etc/sysconfig/network-scripts/` ç›®å½•ä¸‹é¢ã€‚

ç”¨æˆ·å’Œè„šæœ¬éƒ½å¯ä½¿ç”¨ `nmcli` æ¥æ§åˆ¶ NetworkManagerã€‚

`nmcli` å¯ç”¨äºåˆ›å»ºã€æŸ¥çœ‹ã€ç¼–è¾‘ã€åˆ é™¤ã€æ¿€æ´»ã€ç¦ç”¨ç½‘ç»œè¿æ¥ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥æ§åˆ¶å’ŒæŸ¥çœ‹ç½‘ç»œæ¥å£çš„çŠ¶æ€ã€‚




#### è¯­æ³•

`nmcli [é€‰é¡¹] å¯¹è±¡ [å‘½ä»¤] [å‚æ•°]`

ã€ é€‰é¡¹ ã€‘

`-t`, --terse  ä½¿ç”¨ç²¾ç‚¼çš„è¾“å‡ºï¼Œç”¨äºè„šæœ¬

`-p`, --pretty ä½¿ç”¨æ˜“äºé˜…è¯»çš„è¾“å‡ºï¼Œç”¨äºç”¨æˆ·

`-h`, --help

ã€ å¯¹è±¡ ã€‘

generalã€networkingã€radioã€connection æˆ– device

ã€ å‘½ä»¤ ã€‘

å‘½ä»¤åˆ†å¤šç§ï¼šæ™®é€šã€ç½‘ç»œæ§åˆ¶ã€å¹¿æ’­ä¼ è¾“æ§åˆ¶ã€æ´»åŠ¨ç›‘è§†ã€**è¿æ¥ç®¡ç†**ã€**ç½‘ç»œæ¥å£ç®¡ç†**

ç†Ÿæ‚‰è¿™äº›å‘½ä»¤åå¯ **ä½¿ç”¨ç®€å†™**ï¼Œå¦‚ï¼š

```
nmcli connection add type ethernet  # å¯ç®€åŒ–ä¸ºï¼š
nmcli      c      a  type eth
```




#### æ™®é€šå‘½ä»¤

`nmcli general { status | hostname | permissions | logging } [ARGUMENTS...]`

`nmcli general status`  æŸ¥çœ‹ NetworkManager çš„ **æ•´ä½“çŠ¶æ€**ï¼Œ`nmcli genernal` åé¢å¦‚æœä¸è·Ÿä»»ä½•å‘½ä»¤ï¼Œé»˜è®¤ç”¨æ­¤å‘½ä»¤

```
~]# nmcli general status
STATE      CONNECTIVITY  WIFI-HW  WIFI     WWAN-HW  WWAN    
connected  full          enabled  enabled  enabled  enabled
```







#### ç½‘ç»œæ§åˆ¶å‘½ä»¤

`nmcli networking { on | off | connectivity } [ARGUMENTS...]`


##### æŸ¥è¯¢ç½‘ç»œçŠ¶æ€

`nmcli networking connectivity`  æŸ¥è¯¢ç½‘ç»œè¿æ¥çŠ¶æ€ï¼Œç›´æ¥æ˜¾ç¤ºæœ€è¿‘æŸ¥çœ‹è¿‡çš„è¿æ¥çŠ¶æ€

`nmcli networking connectivity check` é‡æ–°æ£€æŸ¥è¿æ¥çŠ¶æ€

è¿”å›çš„ç½‘ç»œè¿æ¥çš„çŠ¶æ€ï¼š

* `none`  ä¸»æœºæœªè¿æ¥åˆ°ä»»ä½•ç½‘ç»œ
* `portal`  ä¸»æœºä½äºç½‘å…³çš„åé¢ï¼Œæ— æ³•è®¿é—®å®Œæ•´çš„äº’è”ç½‘
* `limited`  ä¸»æœºè¿æ¥åˆ°æŸä¸ªç½‘ç»œï¼Œä½†æ— æ³•è®¿é—®äº’è”ç½‘
* `full`  ä¸»æœºè¿æ¥åˆ°æŸä¸ªç½‘ç»œï¼Œå¹¶å¯è®¿é—®äº’è”ç½‘
* `unknown`  æ— æ³•æŸ¥æ˜è¿æ¥çŠ¶æ€


##### å¯ç”¨æˆ–ç¦ç”¨ç½‘ç»œ

`nmcli networking  on/off`  å¯ç”¨ã€ç¦ç”¨ç½‘ç»œã€‚

ç½‘ç»œè¢«ç¦ç”¨æ—¶ï¼Œæ‰€æœ‰ NM ç®¡ç†çš„æ¥å£éƒ½ä¼šåœç”¨ã€‚







#### è¿æ¥ç®¡ç†å‘½ä»¤

`nmcli connection { show | up | down | modify | add | edit | clone | delete | monitor | reload | load | import | export } [ARGUMENTS...]`

å¯ä»¥æŒ‡å®šè¿æ¥åç§°ã€UUIDã€D-Bus è·¯å¾„ã€‚å¦‚æœè¿æ¥åè¿‡äºæ··æ·†ï¼Œå¯ä»¥ä½¿ç”¨ `id`ã€`uuid`ã€`path`ã€`apath` ç­‰å…³é”®å­—ã€‚ä»¥ä¸‹å„å‘½ä»¤å‡é€‚ç”¨ã€‚
{: .notice}

`id ID`  ID ä¸ºè¿æ¥å

`uuid ID`  ID ä¸ºè¿æ¥çš„ UUID

`path`  ID ä¸º D-Bus é™æ€è¿æ¥è·¯å¾„ï¼Œæ ¼å¼ä¸º `/org/freedesktop/NetworkManager/Settings/num` æˆ– `num`



##### `show` | æŸ¥çœ‹æŒ‡å®šè¿æ¥

`nmcli connection show [--active] [ id | uuid | path | apath ] ID...`

æ˜¾ç¤ºè¿æ¥ä¿¡æ¯ã€‚

`nmcli connection show` æŸ¥çœ‹æ‰€æœ‰è¿æ¥

`nmcli connection show ens33` æŸ¥çœ‹æŒ‡å®šè¿æ¥çš„é…ç½®å‚æ•°

`nmcli connection show --active` æŸ¥çœ‹æ¿€æ´»çš„è¿æ¥


##### `up` | æ¿€æ´»è¿æ¥

å¦‚æœéœ€è¦ç‰¹å®šçš„æ¥å£æ¥æ¿€æ´»è¿æ¥ï¼Œå¯ä»¥ä½¿ç”¨ `ifname` å‚æ•°æ¥æŒ‡å®šæ¥å£åç§°ã€‚

å¦‚æœæ²¡æœ‰æŒ‡å®šè¿æ¥åç§°ï¼Œåˆ™å¿…é¡»è¦æŒ‡å®š `ifname` æ¥å£åç§°ã€‚

`nmcli connection up [ id | uuid | path ] ID [ifname ifname] [ap BSSID] [passwd-file file]`

`ifname`  æŒ‡å®šæ¿€æ´»çš„æ¥å£

`ap`  è¦è¿æ¥åˆ°çš„æ— çº¿ AP çš„ BSSID

`passwd-file`  æŒ‡å®šå¯†ç æ–‡ä»¶

```
nmcli connection up id bond0`
```


##### `down` | åœç”¨è¿æ¥

deactivateï¼Œè¯¥æ¥å£ä»å…·æœ‰è‡ªåŠ¨æ¿€æ´»çš„èƒ½åŠ›ã€‚å¯åŒæ—¶ä½œç”¨äºå¤šä¸ªè¿æ¥ã€‚

è¯¥å‘½ä»¤ä¼šåœç”¨æŒ‡å®šçš„æ¿€æ´»è¿æ¥ï¼Œä½†è¿æ¥æ‰€åœ¨çš„ **æ¥å£ä»ç„¶éšæ—¶å‡†å¤‡è¿æ¥**ï¼Œå®ƒä¼šå¯»æ‰¾åˆé€‚çš„è¿æ¥ï¼Œå¦‚æœæ‰¾åˆ°çš„è¿æ¥ä¸­å«æœ‰ `autoconnect` æ ‡ç­¾ï¼ŒåŒ…æ‹¬åˆšè¢«åœç”¨çš„è¿æ¥ï¼Œè¯¥æ¥å£è¿˜æ˜¯å¯ä»¥è¢«å…¶è‡ªåŠ¨æ¿€æ´»ã€‚å› æ­¤ï¼Œå¦‚æœè¿æ¥è¢«è®¾å®šä¸ºè‡ªåŠ¨è¿æ¥ï¼Œå®ƒä»ä¼šåœ¨è¯¥æ¥å£ä¸Šè‡ªåŠ¨æ¿€æ´»ã€‚

åœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œåº”è¯¥ä½¿ç”¨ `nmcli device disconnect` å‘½ä»¤ï¼Œè€Œä¸ç”¨ `down`ã€‚
{: .notice--warning}

å¦‚æœæ²¡æœ‰æŒ‡å®š `--wait` å‚æ•°ï¼Œé»˜è®¤è¶…æ—¶ä¸º 10 ç§’ã€‚

`nmcli connection down [ id | uuid | path | apath ] ID...`

```
nmcli connection down id port0`
```


##### `modify` | ä¿®æ”¹è¿æ¥é…ç½®

`modify` å‘½ä»¤ç”¨äº **å¢åŠ ã€ä¿®æ”¹ã€åˆ é™¤è¿æ¥é…ç½®ä¸­çš„å±æ€§**ã€‚

è¢«ä¿®æ”¹çš„å±æ€§å¯ä»¥ç”¨åˆ«åã€‚

å¦‚æœä¸ºæŸä¸ªå±æ€§è¿½åŠ å€¼ï¼Œåœ¨å±æ€§å‰åŠ  `+`ï¼Œè¦æƒ³ä»å®¹å™¨ç±»çš„å±æ€§ä¸­åˆ é™¤ä¸€ä¸ªå€¼ï¼Œåœ¨å±æ€§å‰åŠ  `-`ï¼Œå¹¶æŒ‡å®šè¦åˆ é™¤çš„å€¼ã€‚`+` å’Œ `-` åªå¯¹æœ‰å¤šä¸ªå€¼çš„å±æ€§èµ·ä½œç”¨ï¼Œå¦‚ `ipv4.dns`ã€`ipv4.addresses`ã€`bond.options` ç­‰ã€‚

`modify [--temporary] [ id | uuid | path ] ID { option value | [+|-]setting.property value } ...`

ä¿®æ”¹å‘é€åˆ° DHCP æœåŠ¡å™¨çš„ä¸»æœºåï¼š

```
~]$ nmcli con modify my-office ipv4.dhcp-hostname ZION ipv6.dhcp-hostname ZION
```

ä¿®æ”¹å‘é€åˆ° DHCP æœåŠ¡å™¨çš„ IPv4 å®¢æˆ·ç«¯åç§°ï¼š

```
~]$ nmcli con modify my-office ipv4.dhcp-client-id neo
```

å¿½ç•¥ DHCP æœåŠ¡å™¨å‘é€åˆ°ä¸»æœºçš„ DNS æœåŠ¡å™¨ï¼š

```
~]$ nmcli con modify my-office ipv4.ignore-auto-dns yes ipv6.ignore-auto-dns yes
```

ä¿®æ”¹ DNS æœåŠ¡å™¨åœ°å€ï¼š

```
~]$ nmcli con mod test-lab ipv4.dns "8.8.8.8 8.8.4.4"
~]$ nmcli con mod test-lab ipv6.dns "2001:4860:4860::8888 2001:4860:4860::8844"
```

æ·»åŠ  DNS æœåŠ¡å™¨åœ°å€ï¼š

```
~]$ nmcli con mod test-lab +ipv4.dns "8.8.8.8 8.8.4.4"
~]$ nmcli con mod test-lab +ipv6.dns "2001:4860:4860::8888 2001:4860:4860::8844"
```

æ·»åŠ é™æ€è·¯ç”±

```
~]# nmcli connection modify eth0 +ipv4.routes "192.168.122.0/24 10.10.10.1"
```

ä¿®æ”¹ IPv4 åœ°å€åŠç½‘å…³

RHEL 7.0:

```
~]# nmcli con mod net-eth0 ipv4.addresses "192.168.2.10/24 192.168.2.1"
~]# nmcli con mod net-eth0 ipv4.method manual
~]# nmcli con up net-eth0
```

RHEL 7.1 :

```
~]# nmcli con mod net-eth0 ipv4.addresses 192.168.2.10/24
~]# nmcli con mod net-eth0 ipv4.gateway 192.168.2.1
~]# nmcli con mod net-eth0 ipv4.method manual
~]# nmcli con up net-eth0
```

ä¿®æ”¹ IPv4 åœ°å€å’Œç½‘å…³çš„å‘½ä»¤åœ¨ RHEL 7.0 ç‰ˆæœ¬ä¸­ï¼Œæ•´ä½“éœ€è¦åŒå¼•å·æ‹¬èµ·æ¥ï¼Œå¼•å·å†…éƒ¨å¯ä»¥ç”¨ `IP åœ°å€ + ç©ºæ ¼ + ç½‘å…³` çš„æ ¼å¼ï¼Œä½†åˆ°äº† RHEL 7.1 ç‰ˆæœ¬ï¼Œå› ä¸º NetworkManager ç‰ˆæœ¬çš„å‡çº§ï¼Œå¯¼è‡´è¯­æ³•ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ã€‚å¿…é¡»åˆ†å¼€æŒ‡å®šï¼ŒæŒ‡å®šæ—¶æ— éœ€åŒå¼•å·ã€‚
{: .notice--warning}


##### `add` | åˆ›å»ºæ–°è¿æ¥

`nmcli connection add [save { yes | no }] { option value | [+|-]setting.property value } ...`

ç”¨æŒ‡å®šå±æ€§ **åˆ›å»ºæ–°è¿æ¥**ã€‚

éœ€è¦æŒ‡å®šè‹¥å¹²å±æ€§çš„å€¼æ¥åˆ›å»ºæ–°è¿æ¥ã€‚è¦æƒ³åˆ›å»ºä¸€ä¸ªæœ‰æ„ä¹‰çš„è¿æ¥ï¼Œè‡³å°‘è¦è®¾å®š `connection.type` å±æ€§ï¼Œæˆ–ä½¿ç”¨åˆ«å `type`ã€‚`type` çš„å–å€¼å¯ä»¥æ˜¯ï¼š

1.  `ethernet`
2.  `wifi`
3.  `wimax`
4.  `pppoe`
5.  `gsm`
6.  `cdma`
7.  `infiniband`
8.  `bluetooth`
9.  `vlan`
10.  `bond`
11.  `bond-slave`
12.  `team`
13.  `team-slave`
14.  `bridge`
15.  `bridge-slave`
16.  `vpn`
17.  `olpc-mesh`
18.  `adsl`
19.  `tun`
20.  `ip-tunnel`
21.  `macvlan`
22.  `vxlan`
23.  `dummy`

`save`  ç”¨æ¥æ§åˆ¶æ˜¯å¦è¦æŠŠè¯¥é…ç½®ä¿å­˜åˆ°ç£ç›˜ï¼Œé»˜è®¤ä¸º `yes`

`type`  æŒ‡å®šè¿æ¥ç±»å‹

`ifname`  æ¥å£åç§°

`con-name`  æŒ‡å®šæ–°è¿æ¥åç§°ã€‚å¦‚æœªæŒ‡å®šï¼Œé»˜è®¤æ ¼å¼ä¸º `type-ifname[-number]`

æŸäº›å±æ€§çš„é»˜è®¤å€¼ï¼š

`connection.autoconnect: yes`

`ONBOOT: yes`

`ipv4.method: manual`

`connection.autoconnect: yes`

`BOOTPROTO: none`

`ONBOOT: yes`

æ·»åŠ åŠ¨æ€é“¾æ¥

```
nmcli connection add type ethernet ifname ens33 con-name MATRIX
```

é…ç½®ä¼šä¿å­˜ä¸º `/etc/sysconfig/network-scripts/ifcfg-MATRIX`ã€‚

å†æ¬¡æ¿€æ´»è¯¥æ¥å£ä¹‹å‰ï¼ŒNetworkManager ä¸ä¼šæ„è¯†åˆ°å¯¹ ifcfg æ–‡ä»¶çš„æ‰‹åŠ¨æ›´æ”¹ã€‚è¦æƒ³ç«‹å³ç”Ÿæ•ˆï¼Œå¿…é¡»ä½¿ç”¨ `nmcli con reload`ã€‚
{: .notice--success}

æ·»åŠ é™æ€è¿æ¥ï¼š

```
~]$ nmcli connection add type ethernet con-name LAB ifname ens33 ip4 192.168.1.56/24 gw4 192.168.1.1
~]$ nmcli con add type ethernet con-name LAB ifname ens9 ip4 10.10.10.10/24 gw4 10.10.10.254
```

æ·»åŠ  `IPv6` åœ°å€å’Œç½‘å…³ä¿¡æ¯ï¼š

```
~]$ nmcli con add type ethernet con-name test-lab ifname ens9 ip4 10.10.10.10/24 gw4 10.10.10.254 ip6 abbe::cafe gw6 2001:db8::1
```
